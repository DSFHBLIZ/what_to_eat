# 项目三层架构设计

本项目采用严格的三层架构设计，将原本混杂在一起的"数据状态 + 业务逻辑 + UI交互"分离成独立的层次，从而提高代码的可维护性和可测试性。

## 层级划分

### 1. 领域层（Domain Layer）

**路径：** `src/domain/`

**责任：** 包含纯函数、状态逻辑、权限规则、验证规则等与业务领域相关的核心逻辑。

**特点：**
- 不依赖于UI框架和实现细节
- 主要由纯函数组成，便于测试
- 包含业务规则和核心逻辑

**主要模块：**
- `domain/validation/`: 表单验证规则和验证逻辑
- `domain/auth/`: 权限规则和检查
- `domain/store/`: 状态管理核心逻辑

### 2. 控制器层（Controller Layer）

**路径：** `src/controllers/`

**责任：** 连接领域层和UI层，提供交互方法、封装副作用。

**特点：**
- 调用领域层的功能实现业务流程
- 处理UI层的事件和请求
- 封装HTTP请求等副作用
- 负责数据转换和状态管理

**主要模块：**
- `controllers/useSearchController.ts`: 搜索控制器
- `controllers/useFormController.ts`: 表单控制器

### 3. UI层（UI Layer）

**路径：** `src/contexts/`, `src/hooks/`

**责任：** 提供组件订阅数据、用于渲染和交互。

**特点：**
- 专注于界面展示和用户交互
- 使用控制器提供的方法处理用户事件
- 不包含业务逻辑，只负责呈现数据和收集用户输入

**主要模块：**
- `contexts/SearchContext.tsx`: 搜索上下文
- `hooks/useForm.tsx`: 表单处理钩子

## 层级间通信

1. **UI层 → 控制器层**：UI组件通过调用控制器提供的方法触发动作
2. **控制器层 → 领域层**：控制器调用领域层的函数处理业务逻辑
3. **领域层 → 控制器层**：通过返回值将结果传递回控制器
4. **控制器层 → UI层**：通过状态更新和回调通知UI层

## 重构效果

通过三层架构的重构，解决了以下问题：

1. **逻辑混乱**：将原本混在一起的代码按职责分离
2. **重复逻辑**：公共逻辑集中在领域层，避免重复
3. **测试困难**：纯函数和业务逻辑集中在领域层，便于单元测试
4. **修改波及范围大**：层与层之间通过明确的接口通信，减少耦合
5. **功能扩展失控**：各层有明确的职责，新功能能更规范地添加

## 示例

### 表单处理流程

1. UI层的`useForm`钩子提供表单交互界面
2. 控制器层的`useFormController`处理表单状态和提交
3. 领域层的`validators.ts`和`formValidation.ts`提供验证规则和表单验证逻辑

### 搜索处理流程

1. UI层的`SearchContext`提供搜索界面交互
2. 控制器层的`useSearchController`处理搜索状态和请求
3. 领域层处理搜索的业务规则和数据模型 