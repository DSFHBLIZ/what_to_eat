"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[438],{8438:function(e,r,t){t.d(r,{C_:function(){return l},Dq:function(){return p},GS:function(){return u},if:function(){return m},lZ:function(){return h},mN:function(){return g},mU:function(){return c},rm:function(){return k},wb:function(){return d}});var n=t(342),i=t(8996),o=t(5467),s=t(3);let a=[];function c(e){a=e}function l(e){let r=[...a];if(e.ingredients&&e.ingredients.length>0&&(r=r.filter(r=>e.ingredients.every(e=>Array.isArray(r.ingredients)&&r.ingredients.some(r=>"string"==typeof r&&r.toLowerCase().includes(e.toLowerCase()))))),e.optionalIngredients&&e.optionalIngredients.length>0&&(r=r.filter(r=>e.optionalIngredients.some(e=>Array.isArray(r.ingredients)&&r.ingredients.some(r=>"string"==typeof r&&r.toLowerCase().includes(e.toLowerCase()))))),e.flavors&&e.flavors.length>0&&(r=r.filter(r=>e.flavors.every(e=>Array.isArray(r.flavors)&&r.flavors.includes(e)))),e.difficulty&&(r=r.filter(r=>r.difficulty===e.difficulty)),e.cuisine&&(r=r.filter(r=>r.cuisine===e.cuisine)),e.cookingMethods&&e.cookingMethods.length>0&&(r=r.filter(r=>e.cookingMethods.some(e=>r.cookingMethod&&Array.isArray(r.cookingMethod)&&r.cookingMethod.includes(e)))),e.dietaryRestrictions&&e.dietaryRestrictions.length>0&&(r=r.filter(r=>e.dietaryRestrictions.some(e=>r.dietaryRestrictions&&Array.isArray(r.dietaryRestrictions)&&r.dietaryRestrictions.includes(e)))),e.searchQuery&&""!==e.searchQuery.trim()){let t=e.searchQuery.toLowerCase().trim();r=r.filter(e=>e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||Array.isArray(e.ingredients)&&e.ingredients.some(e=>"string"==typeof e&&e.toLowerCase().includes(t)))}return r}async function u(e){try{let r={};if(e.ingredients&&e.ingredients.length>0&&(r.ingredients=e.ingredients),e.optionalIngredients&&e.optionalIngredients.length>0&&(r.optionalIngredients=e.optionalIngredients),e.flavors&&e.flavors.length>0&&(r.taste=e.flavors.map(e=>e.toString())),e.difficulty&&(r.difficulty=e.difficulty),e.cuisine&&(r.cuisine=e.cuisine),e.cookingMethods&&e.cookingMethods.length>0&&(r.cookingMethod=e.cookingMethods),e.dietaryRestrictions&&e.dietaryRestrictions.length>0)for(let t of e.dietaryRestrictions)"纯素"===t?r.isVegan=!0:"清真"===t?r.isHalal=!0:"无麸质"===t&&(r.isGlutenFree=!0);if(e.searchQuery&&""!==e.searchQuery.trim()&&(r.searchQuery=e.searchQuery.trim()),r.searchQuery)return console.log("使用搜索API查询: ".concat(r.searchQuery)),await (0,n.s8)(r.searchQuery);let t=n.OQ.from("CHrecipes").select("*");if(r.cuisine&&(t=t.eq("菜系",r.cuisine)),r.difficulty&&(t=t.eq("烹饪难度",r.difficulty)),r.isVegan&&(t=t.eq("是否纯素",!0)),r.isHalal&&(t=t.eq("是否清真",!0)),r.isGlutenFree&&(t=t.eq("是否无麸质",!0)),r.ingredients&&r.ingredients.length>0)for(let e of r.ingredients)t=t.filter("食材","cs","%".concat(e,"%"));if(r.optionalIngredients&&r.optionalIngredients.length>0){let e=r.optionalIngredients.map(e=>"食材::text ilike '%".concat(e,"%' OR 调料::text ilike '%").concat(e,"%'"));e.length>0&&(t=t.or(e.join(",")))}if(r.taste&&r.taste.length>0){let e=r.taste.map(e=>'"口味特点"::jsonb @> \'["'.concat(e,"\"]'")).join(" OR ");e&&(t=t.or(e))}if(r.cookingMethod&&r.cookingMethod.length>0){let e=r.cookingMethod.map(e=>'"烹饪技法"::jsonb @> \'["'.concat(e,"\"]'")).join(" OR ");e&&(t=t.or(e))}console.log("使用多条件筛选API查询",r);let{data:i,error:o}=await t;if(o)throw console.error("Supabase查询出错:",o),o;if(!i||0===i.length)return console.log("没有找到匹配的菜谱"),[];console.log("找到".concat(i.length,"个匹配的菜谱"));let a=(0,s.Ki)(i);if(e.searchQuery&&""!==e.searchQuery.trim()){let r=e.searchQuery.trim();return a.map(e=>{let t=function(e,r){if(!r)return 0;let t=0;for(let n of r.toLowerCase().trim().split(/\s+/).filter(Boolean)){if(e.name&&e.name.toLowerCase().includes(n)&&(t+=15,e.name.toLowerCase()===n?t+=5:e.name.toLowerCase().startsWith(n)&&(t+=3)),Array.isArray(e.ingredients))for(let r of e.ingredients){let e="";if("string"==typeof r?e=r.toLowerCase():"object"==typeof r&&null!==r&&(e=(r.name||r.名称||"").toLowerCase()),e&&e.includes(n)){t+=12,e===n?t+=3:e.startsWith(n)&&(t+=1);break}}if(Array.isArray(e.seasonings))for(let r of e.seasonings){let e="";if("string"==typeof r?e=r.toLowerCase():"object"==typeof r&&null!==r&&(e=(r.name||r.名称||"").toLowerCase()),e&&e.includes(n)){t+=8,e===n?t+=2:e.startsWith(n)&&(t+=1);break}}if(Array.isArray(e.cookingMethod)){for(let r of e.cookingMethod)if("string"==typeof r&&r.toLowerCase().includes(n)){t+=5,r.toLowerCase()===n&&(t+=1);break}}let r=!1;if(e.cookingSteps&&Array.isArray(e.cookingSteps)){for(let i of e.cookingSteps)if("string"==typeof i&&i.toLowerCase().includes(n)){t+=6,r=!0;break}}if(!r&&e.steps&&Array.isArray(e.steps)){for(let r of e.steps)if("string"==typeof r&&r.toLowerCase().includes(n)){t+=6;break}}if(e.description&&e.description.toLowerCase().includes(n)&&(t+=3),e.cuisine&&e.cuisine.toLowerCase().includes(n)&&(t+=4,e.cuisine.toLowerCase()===n&&(t+=1)),Array.isArray(e.flavors)){for(let r of e.flavors)if("string"==typeof r&&r.toLowerCase().includes(n)){t+=4,r.toLowerCase()===n&&(t+=1);break}}}return console.log('菜谱"'.concat(e.name,'"的相关性得分: ').concat(t.toFixed(2))),t}(e,r);return{...e,matchScore:t,matchedIngredients:f(e.ingredients,r),matchedSeasonings:f(e.seasonings,r)}}).sort((e,r)=>(r.matchScore||0)-(e.matchScore||0))}return a}catch(r){return console.error("远程筛选失败:",r),console.log("回退到本地筛选..."),l(e)}}function f(e,r){if(!e||!Array.isArray(e)||!r)return[];let t=r.toLowerCase().trim(),n=[];for(let r of e)if("string"==typeof r)r.toLowerCase().includes(t)&&n.push(r);else if("object"==typeof r&&null!==r){let e=r.name||r.名称;e&&"string"==typeof e&&e.toLowerCase().includes(t)&&n.push(e)}return n}function d(e){return(0,i.x)().find(r=>r.id===e)||null}function g(e){let r=y();if(!r.includes(e))return r.push(e),localStorage.setItem("favoriteRecipes",JSON.stringify(r)),!0;{let t=r.filter(r=>r!==e);return localStorage.setItem("favoriteRecipes",JSON.stringify(t)),!1}}function y(){let e=localStorage.getItem("favoriteRecipes");return e?JSON.parse(e):[]}function h(){let e=y();return a.filter(r=>e.includes(r.id))}function p(e){return y().includes(e)}function m(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{if(null==e)return r&&t&&console.warn("[".concat(r,"] ").concat(t,"值为").concat(e,"，已转换为空数组")),[];if(Array.isArray(e))return e;if("string"==typeof e)try{let r=JSON.parse(e);if(Array.isArray(r))return r}catch(r){return[e]}if("object"==typeof e){if("标签"in e&&void 0!==e.标签){if(Array.isArray(e.标签))return e.标签;if("string"==typeof e.标签)return[e.标签]}if("主要口味"in e&&void 0!==e.主要口味){if(Array.isArray(e.主要口味))return e.主要口味;if("string"==typeof e.主要口味)return[e.主要口味]}}return[e]}catch(r){return console.error("safeArray转换失败",r,e),[]}}function k(e,r,t){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"unknown",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"safeArraySlice";if(void 0===e)return(0,o.H)(n,i,TypeError("尝试对undefined值使用slice"),{arrayType:"undefined",isNull:!1,isUndefined:!0,requestedRange:"".concat(null!=r?r:"0","-").concat(null!=t?t:"end"),stackTrace:Error().stack}),[];if(null===e)return(0,o.H)(n,i,TypeError("尝试对null值使用slice"),{arrayType:"null",isNull:!0,isUndefined:!1,requestedRange:"".concat(null!=r?r:"0","-").concat(null!=t?t:"end"),stackTrace:Error().stack}),[];try{if(Array.isArray(e))try{return e.slice(r,t)}catch(s){return(0,o.H)(n,i,s,{errorLocation:"slice内部操作",arrayLength:e.length,requestedRange:"".concat(null!=r?r:"0","-").concat(null!=t?t:"end"),stackTrace:Error().stack}),[]}return(0,o.H)(n,i,TypeError("尝试对非数组类型(".concat(typeof e,")使用slice")),{arrayType:typeof e,objectConstructor:e.constructor?e.constructor.name:"unknown",sampleValue:String(e).substring(0,100),requestedRange:"".concat(null!=r?r:"0","-").concat(null!=t?t:"end"),stackTrace:Error().stack}),[]}catch(s){return(0,o.H)(n,i,s,{arrayType:typeof e,isNull:null===e,isUndefined:void 0===e,requestedRange:"".concat(null!=r?r:"0","-").concat(null!=t?t:"end"),errorName:s.name,errorMessage:s.message,stackTrace:s.stack||Error().stack}),[]}}}}]);