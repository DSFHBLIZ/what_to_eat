(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[838],{8731:function(e,s,t){Promise.resolve().then(t.bind(t,6148))},6148:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return l}});var a=t(984),r=t(208),n=t(346),o=t(2436),c=t(5467),i=t(2022);function l(){let[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(!1),[m,d]=(0,r.useState)({hasKey:!1,initialized:!1}),u=()=>{try{console.log("初始化Supabase客户端...");let e=i.env.NEXT_PUBLIC_SUPABASE_URL||"https://ijwimydlumbolmpnmezt.supabase.co",s=i.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2lteWRsdW1ib2xtcG5tZXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NjExMDUsImV4cCI6MjA1ODAzNzEwNX0.ynhuFYG6dkoxDgEyDwEnWdZ-DRWx3illLZGyYwn_UnA";if(!e)throw Error("Supabase URL未设置");if(!s)throw Error("Supabase密钥未设置");console.log("Supabase配置信息:"),console.log("- URL:",e),console.log("- 密钥:",s.substring(0,10)+"..."),d({url:e,hasKey:!!s,initialized:!0});let t=(0,o.eI)(e,s,{auth:{autoRefreshToken:!0,persistSession:!0},global:{fetch:(e,s)=>(console.log("发起Supabase请求:",e),fetch(e,{...s,signal:AbortSignal.timeout(15e3)}).catch(e=>{throw console.error("Supabase请求错误:",e),e}))}});return console.log("Supabase客户端初始化成功"),t}catch(e){throw console.error("初始化Supabase客户端失败:",e),(0,c.H)("SupabaseTestPage","initSupabase",e),p({name:"Supabase初始化",status:"error",message:"初始化失败: ".concat(e.message),details:{error:e}}),e}},p=e=>{s(s=>[...s,e])},g=async()=>{l(!0),s([]);try{(0,c.PN)("SupabaseTestPage","runAllTests","开始Supabase连接测试"),(0,c.iB)("SupabaseTestPage","开始测试",{timestamp:new Date().toISOString()});let s=u();await h(s),await x(s),await f(s),await b(s),await w(s),(0,c.PN)("SupabaseTestPage","runAllTests","所有测试完成",{totalTests:e.length,successCount:e.filter(e=>"success"===e.status).length,errorCount:e.filter(e=>"error"===e.status).length})}catch(e){(0,c.H)("SupabaseTestPage","runAllTests",e),p({name:"测试初始化",status:"error",message:"测试过程中发生错误: ".concat(e.message)})}finally{l(!1)}},h=async e=>{let s=performance.now();try{p({name:"基础连接测试",status:"pending",message:"正在测试Supabase连接..."}),console.log("开始Supabase连接测试..."),console.log("使用URL:",e.supabaseUrl),console.log("尝试向CHrecipes表发送简单查询...");let{data:t,error:a}=await e.from("CHrecipes").select("id").limit(1);console.log("查询响应:",{data:t,error:a});let r=performance.now()-s;if(a)throw console.error("连接测试失败，详细错误:",a),a;if(!t)throw console.warn("连接测试返回空数据"),Error("连接成功但返回空数据");p({name:"基础连接测试",status:"success",message:"成功连接到Supabase服务器",duration:r,details:{data:t,responseTime:"".concat(r.toFixed(2),"ms")}})}catch(n){let e=performance.now();console.error("Supabase连接失败，详细错误:",n);let t=(null==n?void 0:n.message)||"未知错误",a=(null==n?void 0:n.code)||"UNKNOWN",r=(null==n?void 0:n.details)||"";(0,c.H)("SupabaseTestPage","testConnection",n),p({name:"基础连接测试",status:"error",message:"连接失败: ".concat(t),duration:e-s,details:{error:n,errorCode:a,errorMessage:t,errorDetails:r,troubleshooting:"请检查Supabase URL和密钥是否正确，以及网络连接是否正常"}})}},x=async e=>{let s=performance.now();try{p({name:"表结构测试",status:"pending",message:"正在获取表结构..."});let t=[];t.push({label:"start",time:performance.now()}),console.log("开始表结构测试 - 终极性能版..."),t.push({label:"query_start",time:performance.now()});let a=await e.from("CHrecipes").select("count()",{count:"exact",head:!0}).limit(1);t.push({label:"query_end",time:performance.now()}),a.data;let r=a.error,n=a.count,o=performance.now()-s;t.push({label:"end",time:performance.now()});let c={total:o.toFixed(1)+"ms",queryPrep:(t[1].time-t[0].time).toFixed(1)+"ms",queryExec:(t[2].time-t[1].time).toFixed(1)+"ms",postProcess:(t[3].time-t[2].time).toFixed(1)+"ms"};if(console.log("表测试性能分析:",c),console.log("表结构超速测试响应:",{hasError:!!r,count:n,responseTime:"".concat(o.toFixed(0),"ms")}),r)throw console.error("表访问测试错误:",r),r;p({name:"表结构测试",status:"success",message:"验证成功: 表包含".concat(n,"条记录，耗时").concat(o.toFixed(0),"ms"),duration:o,details:{recordCount:n,timings:c,perfTrackPoints:t.map(e=>({label:e.label,timeMs:e.time,elapsedFromStart:(e.time-s).toFixed(1)+"ms"}))}})}catch(a){let e=performance.now();console.error("表结构测试失败:",a),(0,c.H)("SupabaseTestPage","testTableSchema",a);let t={message:a.message||"未知错误",code:a.code,details:a.details,hint:a.hint,stack:a.stack};p({name:"表结构测试",status:"error",message:"表结构验证失败: ".concat(a.message||"未知错误"),duration:e-s,details:t})}},f=async e=>{let s=performance.now();try{p({name:"数据读取测试",status:"pending",message:"正在读取菜谱数据..."});let{data:t,error:a,count:r}=await e.from("CHrecipes").select("id, 菜名, 菜系",{count:"exact"}).range(0,9),n=performance.now();if(a)throw a;if(!t||0===t.length)throw Error("无法获取菜谱数据");p({name:"数据读取测试",status:"success",message:"成功读取".concat(t.length,"条菜谱数据，总记录数: ").concat(r),duration:n-s,details:{count:r,samplesCount:t.length,firstFew:t.slice(0,3).map(e=>({id:e.id,name:e.菜名}))}})}catch(t){let e=performance.now();(0,c.H)("SupabaseTestPage","testDataFetch",t),p({name:"数据读取测试",status:"error",message:"数据读取失败: ".concat(t.message),duration:e-s,details:{error:t}})}},b=async e=>{let s=performance.now();try{var t,a,r;p({name:"数据过滤测试",status:"pending",message:"正在测试数据过滤功能..."});let n=await Promise.all([e.from("CHrecipes").select("id, 菜名",{count:"exact"}).eq("菜系","川菜").limit(5),e.from("CHrecipes").select("id, 菜名",{count:"exact"}).ilike("菜名","%鱼%").limit(5),e.from("CHrecipes").select("id, 菜名, 菜系",{count:"exact"}).eq("菜系","粤菜").order("菜名",{ascending:!0}).limit(5)]),o=performance.now();for(let e=0;e<n.length;e++)if(n[e].error)throw Error("过滤测试 #".concat(e+1," 失败: ").concat(n[e].error.message));p({name:"数据过滤测试",status:"success",message:"数据过滤功能正常",duration:o-s,details:{sichuan:{count:n[0].count,samples:null===(t=n[0].data)||void 0===t?void 0:t.map(e=>e.菜名).join(", ")},fishSearch:{count:n[1].count,samples:null===(a=n[1].data)||void 0===a?void 0:a.map(e=>e.菜名).join(", ")},cantonese:{count:n[2].count,samples:null===(r=n[2].data)||void 0===r?void 0:r.map(e=>e.菜名).join(", ")}}})}catch(t){let e=performance.now();(0,c.H)("SupabaseTestPage","testFiltering",t),p({name:"数据过滤测试",status:"error",message:"数据过滤测试失败: ".concat(t.message),duration:e-s,details:{error:t}})}},w=async e=>{let s=performance.now();try{p({name:"性能测试",status:"pending",message:"正在进行性能测试..."});let t=[];for(let s=0;s<3;s++){let a=performance.now();await e.from("CHrecipes").select("id, 菜名, 菜系, 口味特点").order("菜名",{ascending:!0}).range(10*s,(s+1)*10-1);let r=performance.now();t.push(r-a)}let a=t.reduce((e,s)=>e+s,0)/t.length,r=performance.now();p({name:"性能测试",status:"success",message:"性能测试完成，平均查询时间: ".concat(a.toFixed(2),"ms"),duration:r-s,details:{iterations:3,timings:t,averageTime:a}})}catch(t){let e=performance.now();(0,c.H)("SupabaseTestPage","testPerformance",t),p({name:"性能测试",status:"error",message:"性能测试失败: ".concat(t.message),duration:e-s,details:{error:t}})}};return(0,a.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Supabase 连接测试"}),(0,a.jsx)("p",{className:"text-gray-600",children:"此页面用于测试与Supabase数据库的连接并诊断潜在问题"})]}),(0,a.jsxs)("div",{className:"mb-6 flex space-x-2",children:[(0,a.jsx)(n.default,{href:"/debug",className:"px-4 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"返回调试面板"}),(0,a.jsx)("button",{onClick:g,disabled:t,className:"px-4 py-2 rounded ".concat(t?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"),children:t?"测试运行中...":"运行所有测试"})]}),m.initialized&&(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"连接信息"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Supabase URL:"})," ",m.url]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"API Key:"})," ",m.hasKey?"已配置":"未配置"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"这些信息用于连接到您的Supabase项目。如果连接测试失败，请检查这些值是否正确设置在环境变量中。"})]})]}),(0,a.jsx)("div",{className:"space-y-4",children:0!==e.length||t?e.map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-lg overflow-hidden ".concat("success"===e.status?"border-green-300":"error"===e.status?"border-red-300":"border-yellow-300"),children:[(0,a.jsxs)("div",{className:"px-4 py-3 flex justify-between items-center ".concat("success"===e.status?"bg-green-50":"error"===e.status?"bg-red-50":"bg-yellow-50"),children:[(0,a.jsxs)("div",{className:"flex items-center",children:["success"===e.status&&(0,a.jsx)("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===e.status&&(0,a.jsx)("svg",{className:"w-5 h-5 text-red-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"pending"===e.status&&(0,a.jsxs)("svg",{className:"w-5 h-5 text-yellow-600 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,a.jsx)("h3",{className:"font-medium ".concat("success"===e.status?"text-green-800":"error"===e.status?"text-red-800":"text-yellow-800"),children:e.name})]}),e.duration&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[e.duration.toFixed(0),"ms"]})]}),(0,a.jsxs)("div",{className:"p-4 bg-white",children:[(0,a.jsx)("p",{className:"mb-3 ".concat("error"===e.status?"text-red-600":"text-gray-700"),children:e.message}),e.details&&"pending"!==e.status&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsxs)("details",{children:[(0,a.jsx)("summary",{className:"text-sm font-medium text-gray-600 cursor-pointer",children:"查看详细信息"}),(0,a.jsx)("div",{className:"mt-2 bg-gray-50 p-3 rounded text-xs border border-gray-200 overflow-auto max-h-60",children:(0,a.jsx)("pre",{children:JSON.stringify(e.details,null,2)})})]})})]})]},s)):(0,a.jsx)("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 text-center",children:(0,a.jsx)("p",{className:"text-gray-500",children:'点击"运行所有测试"按钮开始诊断'})})}),(0,a.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"测试说明"}),(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-2 text-blue-800",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:"基础连接测试"})," - 检查是否能成功连接到Supabase服务器"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:"表结构测试"})," - 验证数据库表是否包含所需的字段和正确的数据类型"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:"数据读取测试"})," - 检查是否能成功获取菜谱数据并支持分页"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:"数据过滤测试"})," - 验证各种过滤条件是否正常工作"]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-medium",children:"性能测试"})," - 评估数据库查询的响应时间"]})]}),(0,a.jsx)("p",{className:"mt-4 text-sm text-blue-600",children:"如果任何测试失败，请检查环境变量配置和Supabase服务状态。 所有测试结果都会被记录到错误日志系统中，以便后续分析。"})]})]})}},5467:function(e,s,t){"use strict";t.d(s,{H:function(){return o},KE:function(){return c},NB:function(){return d},PN:function(){return i},T1:function(){return m},eX:function(){return p},iB:function(){return l},mt:function(){return u}});let a=[],r=[],n=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),o=(e,s,t,r)=>{let o="string"==typeof t?t:t.message,c="string"==typeof t?void 0:t.stack,i="string"==typeof t?"CustomError":t.name,l={id:n(),timestamp:new Date().toISOString(),type:i,message:o,component:e,operation:s,severity:"error",details:r,stack:c};return a.unshift(l),a.length>50&&(a=a.slice(0,50)),console.error("[".concat(e,"][").concat(s,"] ").concat(o),r||""),l.id},c=(e,s,t,r)=>{let o={id:n(),timestamp:new Date().toISOString(),type:"Warning",message:t,component:e,operation:s,severity:"warning",details:r};return a.unshift(o),a.length>50&&(a=a.slice(0,50)),console.warn("[".concat(e,"][").concat(s,"] ").concat(t),r||""),o.id},i=(e,s,t,r)=>{let o={id:n(),timestamp:new Date().toISOString(),type:"Info",message:t,component:e,operation:s,severity:"info",details:r};return a.unshift(o),a.length>50&&(a=a.slice(0,50)),console.info("[".concat(e,"][").concat(s,"] ").concat(t),r||""),o.id},l=(e,s,t)=>{let a={id:n(),timestamp:new Date().toISOString(),lastComponent:e,lastAction:s,lastData:t};return r.unshift(a),r.length>20&&(r=r.slice(0,20)),a.id},m=()=>[...a],d=()=>[...r],u=()=>{a=[]},p=()=>{r=[]}}},function(e){e.O(0,[346,410,115,69,744],function(){return e(e.s=8731)}),_N_E=e.O()}]);