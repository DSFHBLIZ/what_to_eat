(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[670],{2294:function(e,s,t){Promise.resolve().then(t.bind(t,7209))},7209:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return m}});var a=t(984),n=t(208),r=t(346),l=t(5467),i=t(2436),c=t(2022);function d(e){let{title:s,children:t,defaultOpen:r=!1}=e,[l,i]=(0,n.useState)(r);return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg mb-6 overflow-hidden",children:[(0,a.jsxs)("button",{className:"w-full px-4 py-3 flex justify-between items-center bg-gray-50 hover:bg-gray-100",onClick:()=>i(!l),children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800",children:s}),(0,a.jsx)("svg",{className:"w-5 h-5 transform transition-transform ".concat(l?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&(0,a.jsx)("div",{className:"p-4 bg-white",children:t})]})}function o(e){let{data:s}=e;return s?(0,a.jsx)("pre",{className:"bg-gray-800 text-gray-200 p-4 rounded-md overflow-x-auto text-sm",children:JSON.stringify(s,null,2)}):(0,a.jsx)("p",{className:"text-gray-500",children:"无数据"})}function m(){let[e,s]=(0,n.useState)([]),[t,m]=(0,n.useState)([]),[x,h]=(0,n.useState)({}),[u,p]=(0,n.useState)({}),[g,j]=(0,n.useState)("未检查"),[b,N]=(0,n.useState)(null),[y,f]=(0,n.useState)("errors"),[v,w]=(0,n.useState)({status:"idle",data:null}),[S,k]=(0,n.useState)({status:"idle",data:null});(0,n.useEffect)(()=>{E(),I(),A(),_()},[]);let E=()=>{s((0,l.T1)())},I=()=>{m((0,l.NB)())},A=()=>{let e=window.navigator;h({userAgent:null==e?void 0:e.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight},memory:(null==e?void 0:e.deviceMemory)?"".concat(e.deviceMemory," GB"):"未知",connection:(null==e?void 0:e.connection)?{effectiveType:e.connection.effectiveType,downlink:e.connection.downlink,rtt:e.connection.rtt}:void 0,platform:null==e?void 0:e.platform,language:null==e?void 0:e.language,cookiesEnabled:null==e?void 0:e.cookieEnabled,timestamp:new Date().toISOString()})},_=()=>{p({NODE_ENV:"production",NEXT_PUBLIC_SUPABASE_URL:c.env.NEXT_PUBLIC_SUPABASE_URL||"未设置",NEXT_PUBLIC_SUPABASE_ANON_KEY:c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY?"已设置":"未设置"})},C=async()=>{try{j("检查中...");let e=c.env.NEXT_PUBLIC_SUPABASE_URL||"https://ijwimydlumbolmpnmezt.supabase.co",s=c.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2lteWRsdW1ib2xtcG5tZXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NjExMDUsImV4cCI6MjA1ODAzNzEwNX0.ynhuFYG6dkoxDgEyDwEnWdZ-DRWx3illLZGyYwn_UnA",t=(0,i.eI)(e,s),a=performance.now(),{data:n,error:r,count:l}=await t.from("CHrecipes").select("id",{count:"exact"}).limit(1),d=performance.now();if(r){j("错误: ".concat(r.message));return}j("连接成功"),N({totalRecords:l,queryTime:"".concat((d-a).toFixed(2),"ms"),sampleRecord:n&&n.length>0?n[0]:null})}catch(e){j("错误: ".concat(e.message))}},D=async()=>{try{w({status:"loading",data:null,lastChecked:new Date().toISOString()});let e=await fetch("/api/db-status"),s=await e.json();w({status:"success",data:s,lastChecked:new Date().toISOString()})}catch(e){w({status:"error",data:null,error:e.message,lastChecked:new Date().toISOString()})}},P=async()=>{try{k({status:"loading",data:null,lastChecked:new Date().toISOString()});let e=performance.now(),s=await fetch("/api/recipes"),t=performance.now();if(!s.ok){let e=await s.json();throw Error("API返回错误: ".concat(s.status," - ").concat(e.error||s.statusText))}let a=await s.json();k({status:"success",data:{totalRecipes:Array.isArray(a)?a.length:"API未返回数组",sampleData:Array.isArray(a)&&a.length>0?a[0]:null,responseTime:"".concat((t-e).toFixed(2),"ms"),status:s.status},lastChecked:new Date().toISOString()})}catch(e){k({status:"error",data:null,error:e.message,lastChecked:new Date().toISOString()})}};return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2",children:"\uD83D\uDEE0️ 调试仪表盘"}),(0,a.jsx)("p",{className:"text-gray-600",children:"系统状态、错误日志和诊断工具"})]}),(0,a.jsxs)("div",{className:"flex mb-6 bg-gray-100 p-1 rounded-lg overflow-x-auto",children:[(0,a.jsx)("button",{className:"px-4 py-2 font-medium rounded-md transition-colors ".concat("errors"===y?"bg-white shadow-sm":"hover:bg-gray-200"),onClick:()=>f("errors"),children:"错误日志"}),(0,a.jsx)("button",{className:"px-4 py-2 font-medium rounded-md transition-colors ".concat("app-state"===y?"bg-white shadow-sm":"hover:bg-gray-200"),onClick:()=>f("app-state"),children:"应用状态"}),(0,a.jsx)("button",{className:"px-4 py-2 font-medium rounded-md transition-colors ".concat("system"===y?"bg-white shadow-sm":"hover:bg-gray-200"),onClick:()=>f("system"),children:"系统信息"}),(0,a.jsx)("button",{className:"px-4 py-2 font-medium rounded-md transition-colors ".concat("database"===y?"bg-white shadow-sm":"hover:bg-gray-200"),onClick:()=>f("database"),children:"数据库状态"}),(0,a.jsx)("button",{className:"px-4 py-2 font-medium rounded-md transition-colors ".concat("api"===y?"bg-white shadow-sm":"hover:bg-gray-200"),onClick:()=>f("api"),children:"API测试"})]}),"errors"===y&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"错误日志"}),(0,a.jsx)("button",{className:"px-3 py-1 text-sm bg-red-50 text-red-600 border border-red-200 rounded-md hover:bg-red-100",onClick:()=>{(0,l.mt)(),E()},children:"清除日志"})]}),0===e.length?(0,a.jsx)("p",{className:"text-gray-500 py-4",children:"还没有错误日志"}):(0,a.jsx)("div",{className:"divide-y",children:e.map(e=>(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs rounded-full ".concat("error"===e.severity?"bg-red-100 text-red-800":"warning"===e.severity?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800"),children:e.severity}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:e.component}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:e.operation}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:new Date(e.timestamp).toLocaleString()})]}),(0,a.jsx)("p",{className:"font-medium mb-2",children:e.message}),e.details&&(0,a.jsx)(d,{title:"详细信息",children:(0,a.jsx)(o,{data:e.details})}),e.stack&&(0,a.jsx)(d,{title:"堆栈跟踪",children:(0,a.jsx)("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:e.stack})})]},e.id))})]}),"app-state"===y&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"应用状态历史"}),(0,a.jsx)("button",{className:"px-3 py-1 text-sm bg-red-50 text-red-600 border border-red-200 rounded-md hover:bg-red-100",onClick:()=>{(0,l.eX)(),I()},children:"清除历史"})]}),0===t.length?(0,a.jsx)("p",{className:"text-gray-500 py-4",children:"还没有应用状态历史"}):(0,a.jsx)("div",{className:"divide-y",children:t.map(e=>(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:e.lastComponent}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:e.lastAction}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full",children:new Date(e.timestamp).toLocaleString()})]}),e.lastData&&(0,a.jsx)(d,{title:"状态数据",children:(0,a.jsx)(o,{data:e.lastData})})]},e.id))})]}),"system"===y&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"系统信息"}),(0,a.jsx)(d,{title:"浏览器和操作系统",defaultOpen:!0,children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"User Agent"}),(0,a.jsx)("p",{className:"break-all",children:x.userAgent||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"平台"}),(0,a.jsx)("p",{children:x.platform||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"内存"}),(0,a.jsx)("p",{children:x.memory||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"语言"}),(0,a.jsx)("p",{children:x.language||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"视口大小"}),(0,a.jsx)("p",{children:x.viewport?"".concat(x.viewport.width," x ").concat(x.viewport.height):"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Cookie启用"}),(0,a.jsx)("p",{children:void 0!==x.cookiesEnabled?x.cookiesEnabled?"是":"否":"未知"})]}),x.connection&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"网络类型"}),(0,a.jsx)("p",{children:x.connection.effectiveType||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"下载速度"}),(0,a.jsx)("p",{children:x.connection.downlink?"".concat(x.connection.downlink," Mbps"):"未知"})]})]})]})}),(0,a.jsxs)(d,{title:"环境变量",defaultOpen:!0,children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"NODE_ENV"}),(0,a.jsx)("p",{children:u.NODE_ENV||"未知"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"NEXT_PUBLIC_SUPABASE_URL"}),(0,a.jsx)("p",{className:"break-all",children:u.NEXT_PUBLIC_SUPABASE_URL||"未设置"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"NEXT_PUBLIC_SUPABASE_ANON_KEY"}),(0,a.jsx)("p",{children:u.NEXT_PUBLIC_SUPABASE_ANON_KEY||"未设置"})]})]}),(0,a.jsx)("button",{className:"mt-4 px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",onClick:_,children:"刷新环境变量"})]})]}),"database"===y&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"数据库状态"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsxs)(d,{title:"客户端直接连接测试",defaultOpen:!0,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("连接成功"===g?"bg-green-500":"检查中..."===g?"bg-yellow-500":"bg-red-500")}),(0,a.jsxs)("p",{className:"font-medium",children:["状态: ",g]})]}),b&&(0,a.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"记录总数:"})," ",b.totalRecords]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"text-gray-500",children:"查询耗时:"})," ",b.queryTime]}),b.sampleRecord&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"样本记录:"}),(0,a.jsx)(o,{data:b.sampleRecord})]})]})]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",onClick:C,children:"测试连接"})]}),(0,a.jsxs)(d,{title:"通过API检查数据库状态",defaultOpen:!0,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("success"===v.status?"bg-green-500":"loading"===v.status?"bg-yellow-500":"error"===v.status?"bg-red-500":"bg-gray-300")}),(0,a.jsxs)("p",{className:"font-medium",children:["状态: ","idle"===v.status?"未检查":"loading"===v.status?"检查中...":"success"===v.status?"连接成功":"连接失败"]})]}),v.lastChecked&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-3",children:["上次检查: ",new Date(v.lastChecked).toLocaleString()]}),v.error&&(0,a.jsxs)("div",{className:"my-3 p-3 bg-red-50 text-red-700 rounded-md",children:[(0,a.jsx)("p",{className:"font-medium",children:"错误:"}),(0,a.jsx)("p",{children:v.error})]}),v.data&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"API响应:"}),(0,a.jsx)(o,{data:v.data})]})]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",onClick:D,disabled:"loading"===v.status,children:"loading"===v.status?"检查中...":"检查数据库状态"})]})]})]}),"api"===y&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"API测试"}),(0,a.jsxs)(d,{title:"菜谱API测试",defaultOpen:!0,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat("success"===S.status?"bg-green-500":"loading"===S.status?"bg-yellow-500":"error"===S.status?"bg-red-500":"bg-gray-300")}),(0,a.jsxs)("p",{className:"font-medium",children:["状态: ","idle"===S.status?"未测试":"loading"===S.status?"测试中...":"success"===S.status?"测试成功":"测试失败"]})]}),S.lastChecked&&(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-3",children:["上次测试: ",new Date(S.lastChecked).toLocaleString()]}),S.error&&(0,a.jsxs)("div",{className:"my-3 p-3 bg-red-50 text-red-700 rounded-md",children:[(0,a.jsx)("p",{className:"font-medium",children:"错误:"}),(0,a.jsx)("p",{children:S.error})]}),S.data&&(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"总菜谱数:"}),(0,a.jsx)("p",{className:"font-medium",children:S.data.totalRecipes})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"响应时间:"}),(0,a.jsx)("p",{className:"font-medium",children:S.data.responseTime})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"HTTP状态:"}),(0,a.jsx)("p",{className:"font-medium",children:S.data.status})]})]}),S.data.sampleData&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-gray-500 mb-1",children:"样本数据:"}),(0,a.jsx)(o,{data:S.data.sampleData})]})]})]}),(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200",onClick:P,disabled:"loading"===S.status,children:"loading"===S.status?"测试中...":"测试菜谱API"})]}),(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"所有API端点"}),(0,a.jsxs)("ul",{className:"list-disc pl-5 space-y-2",children:[(0,a.jsxs)("li",{children:[(0,a.jsx)(r.default,{href:"/api/recipes",target:"_blank",className:"text-blue-600 hover:underline",children:"/api/recipes"}),(0,a.jsx)("span",{className:"text-gray-500 ml-2",children:"- 获取所有菜谱"})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)(r.default,{href:"/api/db-status",target:"_blank",className:"text-blue-600 hover:underline",children:"/api/db-status"}),(0,a.jsx)("span",{className:"text-gray-500 ml-2",children:"- 检查数据库连接状态"})]})]})]})]}),(0,a.jsxs)("div",{className:"mt-12 pt-6 border-t border-gray-200 text-center text-gray-500 text-sm",children:[(0,a.jsx)("p",{children:"系统诊断工具 v1.0.0"}),(0,a.jsx)("p",{className:"mt-1",children:(0,a.jsx)(r.default,{href:"/",className:"text-blue-500 hover:underline",children:"返回首页"})})]})]})}},5467:function(e,s,t){"use strict";t.d(s,{H:function(){return l},KE:function(){return i},NB:function(){return m},PN:function(){return c},T1:function(){return o},eX:function(){return h},iB:function(){return d},mt:function(){return x}});let a=[],n=[],r=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),l=(e,s,t,n)=>{let l="string"==typeof t?t:t.message,i="string"==typeof t?void 0:t.stack,c="string"==typeof t?"CustomError":t.name,d={id:r(),timestamp:new Date().toISOString(),type:c,message:l,component:e,operation:s,severity:"error",details:n,stack:i};return a.unshift(d),a.length>50&&(a=a.slice(0,50)),console.error("[".concat(e,"][").concat(s,"] ").concat(l),n||""),d.id},i=(e,s,t,n)=>{let l={id:r(),timestamp:new Date().toISOString(),type:"Warning",message:t,component:e,operation:s,severity:"warning",details:n};return a.unshift(l),a.length>50&&(a=a.slice(0,50)),console.warn("[".concat(e,"][").concat(s,"] ").concat(t),n||""),l.id},c=(e,s,t,n)=>{let l={id:r(),timestamp:new Date().toISOString(),type:"Info",message:t,component:e,operation:s,severity:"info",details:n};return a.unshift(l),a.length>50&&(a=a.slice(0,50)),console.info("[".concat(e,"][").concat(s,"] ").concat(t),n||""),l.id},d=(e,s,t)=>{let a={id:r(),timestamp:new Date().toISOString(),lastComponent:e,lastAction:s,lastData:t};return n.unshift(a),n.length>20&&(n=n.slice(0,20)),a.id},o=()=>[...a],m=()=>[...n],x=()=>{a=[]},h=()=>{n=[]}}},function(e){e.O(0,[346,410,115,69,744],function(){return e(e.s=2294)}),_N_E=e.O()}]);