"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[292],{998:function(e,t,r){r.d(t,{Z:function(){return u}});var n=r(208);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),s=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),l=e=>{let t=s(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:l,className:c="",children:u,iconNode:d,...h}=e;return(0,n.createElement)("svg",{ref:t,...i,width:a,height:a,stroke:r,strokeWidth:l?24*Number(s)/Number(a):s,className:o("lucide",c),...h},[...d.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,n.forwardRef)((r,s)=>{let{className:i,...u}=r;return(0,n.createElement)(c,{ref:s,iconNode:t,className:o("lucide-".concat(a(l(e))),"lucide-".concat(e),i),...u})});return r.displayName=l(e),r}},2137:function(e,t,r){r.d(t,{Z:function(){return n}});let n=(0,r(998).Z)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},5747:function(e,t,r){r.d(t,{Z:function(){return n}});let n=(0,r(998).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},6665:function(e,t,r){var n=r(319);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},4030:function(e,t,r){r.r(t);var n=r(984);r(208),t.default=()=>(0,n.jsx)("footer",{className:"bg-white py-6 border-t border-gray-100",children:(0,n.jsx)("div",{className:"container mx-auto px-6",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-gray-500 text-sm mb-4",children:"本网站菜谱内容来源于网络，仅供参考。请根据自身情况判断使用，本站不对由此产生的后果负责。"}),(0,n.jsxs)("p",{className:"text-gray-400 text-xs mt-2",children:["\xa9 ",new Date().getFullYear()," 今天吃什么 - 版权所有"]})]})})})},1111:function(e,t,r){r.r(t);var n=r(984),a=r(208),s=r(346),l=r(1409);t.default=e=>{let{className:t=""}=e,[r,o]=(0,a.useState)(!1),i=e=>{(0,l.Vc)({type:"other",label:"导航到".concat(e),value:e})};return(0,n.jsxs)("nav",{className:"fixed top-0 left-0 right-0 bg-white z-10 shadow-sm ".concat(t),children:[(0,n.jsx)("div",{className:"container-max",children:(0,n.jsxs)("div",{className:"flex justify-between h-16",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(s.default,{href:"/",className:"text-[22px] font-bold text-blue-600",onClick:()=>i("首页"),children:"今天吃什么？"})}),(0,n.jsx)("div",{className:"flex items-center sm:hidden",children:(0,n.jsxs)("button",{type:"button",className:"inline-flex items-center justify-center p-2 rounded-md text-gray-500 hover:text-gray-700","aria-expanded":"false",onClick:()=>{o(!r)},children:[(0,n.jsx)("span",{className:"sr-only",children:"打开主菜单"}),r?(0,n.jsx)("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}):(0,n.jsx)("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})]})}),(0,n.jsxs)("div",{className:"hidden sm:flex sm:items-center sm:space-x-8",children:[(0,n.jsx)(s.default,{href:"/",className:"text-[17px] text-gray-700 hover:text-gray-900",onClick:()=>i("首页"),children:"首页"}),(0,n.jsx)(s.default,{href:"/recipes",className:"text-[17px] text-gray-700 hover:text-gray-900",onClick:()=>i("菜谱"),children:"菜谱"}),(0,n.jsx)(s.default,{href:"/contact",className:"text-[17px] text-gray-700 hover:text-gray-900",onClick:()=>i("关于我们"),children:"关于我们"})]})]})}),(0,n.jsx)("div",{className:"sm:hidden ".concat(r?"block":"hidden"),children:(0,n.jsxs)("div",{className:"pt-2 pb-3 space-y-1 border-t border-gray-100",children:[(0,n.jsx)(s.default,{href:"/",className:"block px-5 py-3 text-[16px] text-gray-700 hover:bg-gray-50",onClick:()=>{i("首页"),o(!1)},children:"首页"}),(0,n.jsx)(s.default,{href:"/recipes",className:"block px-5 py-3 text-[16px] text-gray-700 hover:bg-gray-50",onClick:()=>{i("菜谱"),o(!1)},children:"菜谱"}),(0,n.jsx)(s.default,{href:"/contact",className:"block px-5 py-3 text-[16px] text-gray-700 hover:bg-gray-50",onClick:()=>{i("关于我们"),o(!1)},children:"关于我们"})]})})]})}},3391:function(e,t,r){r.r(t),r.d(t,{default:function(){return d}});var n=r(984),a=r(208),s=r(5747);let l=(0,r(998).Z)("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var o=r(2137),i=r(2128),c=r(6665),u=e=>{let{label:t,color:r="blue",size:a="md",onRemove:l,onClick:o,className:i=""}=e;return(0,n.jsxs)("div",{className:"\n        inline-flex items-center rounded-full border\n        ".concat({blue:"bg-blue-500 text-white border-blue-600",green:"bg-green-500 text-white border-green-600",yellow:"bg-yellow-500 text-white border-yellow-600",red:"bg-red-500 text-white border-red-600",gray:"bg-gray-500 text-white border-gray-600",purple:"bg-purple-500 text-white border-purple-600"}[r]," \n        ").concat({sm:"text-xs py-0.5 px-2",md:"text-sm py-1 px-3",lg:"text-base py-1.5 px-4"}[a],"\n        ").concat(o?"cursor-pointer hover:opacity-80":"","\n        ").concat(i,"\n      "),onClick:o,children:[(0,n.jsx)("span",{className:"truncate max-w-[180px]",children:t}),l&&(0,n.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),l()},className:"\n            flex-shrink-0 rounded-full \n            hover:bg-opacity-20 hover:bg-gray-900\n            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\n          ","aria-label":"移除 ".concat(t),children:(0,n.jsx)(s.Z,{className:{sm:"w-3.5 h-3.5 ml-1",md:"w-4 h-4 ml-1.5",lg:"w-5 h-5 ml-2"}[a]})})]})},d=e=>{var t;let{placeholder:r="搜索菜谱、食材或烹饪方法...",initialValue:d="",onSearch:h,onIngredientSearch:f,className:m="",showFilterButton:g=!1,onFilterClick:x,disabled:p=!1}=e,[y,v]=(0,a.useState)(""),[b,w]=(0,a.useState)(""),[N,j]=(0,a.useState)([]),[E,k]=(0,a.useState)(!1),[C,L]=(0,a.useState)(null),[S,A]=(0,a.useState)([]),[R,I]=(0,a.useState)([]),[_,M]=(0,a.useState)("AND"),T=(0,a.useRef)(null),P=(0,a.useRef)(null),q=(0,a.useRef)(null),W=(0,c.useRouter)(),H=(0,c.usePathname)();t=()=>{k(!1),L(null)},(0,a.useEffect)(()=>{let e=e=>{!q.current||q.current.contains(e.target)||t(e)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[q,t]),(0,a.useEffect)(()=>{let e=e=>{if(e.detail&&e.detail.tag){let t=e.detail.tag;S.includes(t)||A(e=>[...e,t])}},t=e=>{if(e.detail&&e.detail.tag){let t=e.detail.tag;A(e=>e.filter(e=>e!==t))}};return T.current&&(T.current.addEventListener("add-tag",e),T.current.addEventListener("remove-tag",t)),()=>{T.current&&(T.current.removeEventListener("add-tag",e),T.current.removeEventListener("remove-tag",t))}},[S]),(0,a.useEffect)(()=>{let e=()=>{console.log("SearchBar: 收到重置所有筛选器事件"),v(""),w(""),A([]),I([]);let e=document.querySelector('input[aria-label="搜索"]');e&&(e.value="")};return document.addEventListener("reset-all-filters",e),()=>{document.removeEventListener("reset-all-filters",e)}},[]);let O=async e=>{let t=e.target.value;if(v(t),t.trim().length>1)try{let e=await (0,i.rf)(t);j(e),k(!0),L("required")}catch(e){console.error("获取搜索建议失败:",e),j([])}else j([]),k(!1),L(null)},U=async e=>{let t=e.target.value;if(w(t),t.trim().length>1)try{let e=await (0,i.rf)(t);j(e),k(!0),L("optional")}catch(e){console.error("获取搜索建议失败:",e),j([])}else j([]),k(!1),L(null)},Z=e=>{if(null==e||e.preventDefault(),!p){if(f)f(S,R);else if("/"===H){let e=new URLSearchParams;S.forEach(t=>{e.append("requiredIngredients",t)}),R.forEach(t=>{e.append("optionalIngredients",t)}),y.trim()&&e.set("query",y.trim());let t=z();t.cuisine&&e.set("cuisine",t.cuisine),t.flavors&&t.flavors.length>0&&t.flavors.forEach(t=>{e.append("flavors",t)}),t.difficulty&&e.set("difficulty",t.difficulty),t.cookingMethods&&t.cookingMethods.length>0&&t.cookingMethods.forEach(t=>{e.append("cookingMethods",t)}),t.dietaryRestrictions&&t.dietaryRestrictions.length>0&&t.dietaryRestrictions.forEach(t=>{e.append("dietaryRestrictions",t)});try{sessionStorage.setItem("lastSearchFilters",JSON.stringify({requiredIngredients:S,optionalIngredients:R,query:y.trim(),...t}))}catch(e){console.warn("无法保存筛选条件到sessionStorage:",e)}(S.length>0||R.length>0||y.trim()||D(t))&&W.push("/recipes?".concat(e.toString()))}k(!1),L(null)}},z=()=>{let e={cuisine:null,flavors:[],difficulty:null,cookingMethods:[],dietaryRestrictions:[]};if(window.document)try{document.querySelectorAll('[data-filter-active="true"]').forEach(t=>{let r=t.getAttribute("data-filter-type"),n=t.getAttribute("data-filter-value");if(r&&n)switch(r){case"cuisine":e.cuisine=n;break;case"flavor":e.flavors.includes(n)||e.flavors.push(n);break;case"difficulty":e.difficulty=n;break;case"cookingMethod":e.cookingMethods.includes(n)||e.cookingMethods.push(n);break;case"dietaryRestriction":e.dietaryRestrictions.includes(n)||e.dietaryRestrictions.push(n)}})}catch(e){console.warn("获取筛选条件时出错:",e)}return e},D=e=>e.cuisine||e.flavors&&e.flavors.length>0||e.difficulty||e.cookingMethods&&e.cookingMethods.length>0||e.dietaryRestrictions&&e.dietaryRestrictions.length>0,B=e=>{var t,r;"required"===C?(S.includes(e)||A([...S,e]),v(""),null===(t=T.current)||void 0===t||t.focus()):"optional"===C&&(R.includes(e)||I([...R,e]),w(""),null===(r=P.current)||void 0===r||r.focus()),k(!1),L(null)},F=(0,a.useCallback)(e=>{if(e){console.log("移除标签: ".concat(e)),S.includes(e)&&A(t=>t.filter(t=>t!==e)),R.includes(e)&&I(t=>t.filter(t=>t!==e));{console.log("触发filter-tag-removed事件:",e);let t=new CustomEvent("filter-tag-removed",{detail:{tag:e},bubbles:!0});document.dispatchEvent(t)}f&&f(S.filter(t=>t!==e),R.filter(t=>t!==e))}},[S,R,f]),K=e=>{"Enter"===e.key&&(e.preventDefault(),Z())};return(0,n.jsxs)("div",{className:"relative w-full ".concat(m),children:[(0,n.jsxs)("form",{onSubmit:Z,className:"w-full",children:[(0,n.jsx)("div",{className:"relative mb-2",children:(0,n.jsxs)("div",{className:"flex items-center border rounded-md focus-within:ring-2 focus-within:ring-blue-300 bg-white overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-1 px-2 py-1 flex-grow",children:[S.map((e,t)=>(0,n.jsx)(u,{label:e,onRemove:()=>F(e),className:"bg-blue-100 text-blue-700"},"req-".concat(t))),(0,n.jsx)("input",{ref:T,type:"text",className:"search-bar-required flex-grow min-w-[100px] py-2 px-3 text-gray-700 focus:outline-none",placeholder:"必选食材/调料",value:y,onChange:O,onKeyDown:K,disabled:p,"aria-label":"必选食材搜索"})]}),(y.trim()||S.length>0)&&(0,n.jsx)("button",{type:"button",onClick:()=>{var e;v(""),A([]),null===(e=T.current)||void 0===e||e.focus()},className:"text-gray-400 hover:text-gray-600 px-2","aria-label":"清除必选输入",children:(0,n.jsx)(s.Z,{size:16})})]})}),(0,n.jsx)("div",{className:"relative mb-4",children:(0,n.jsxs)("div",{className:"flex items-center border rounded-md focus-within:ring-2 focus-within:ring-blue-300 bg-white overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-1 px-2 py-1 flex-grow",children:[R.map((e,t)=>(0,n.jsx)(u,{label:e,onRemove:()=>F(e),className:"bg-green-100 text-green-700"},"opt-".concat(t))),(0,n.jsx)("input",{ref:P,type:"text",className:"search-bar-optional flex-grow min-w-[100px] py-2 px-3 text-gray-700 focus:outline-none",placeholder:"可选食材/调料",value:b,onChange:U,onKeyDown:K,disabled:p,"aria-label":"可选食材搜索"})]}),(b.trim()||R.length>0)&&(0,n.jsx)("button",{type:"button",onClick:()=>{var e;w(""),I([]),null===(e=P.current)||void 0===e||e.focus()},className:"text-gray-400 hover:text-gray-600 px-2","aria-label":"清除可选输入",children:(0,n.jsx)(s.Z,{size:16})})]})}),(0,n.jsx)("div",{className:"flex w-full justify-center",children:(0,n.jsxs)("button",{type:"submit",className:"w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-6 py-2 flex items-center justify-center transition-colors ".concat(p?"opacity-50 cursor-not-allowed":""),disabled:p,children:[(0,n.jsx)(l,{size:18,className:"mr-2"}),(0,n.jsx)("span",{children:"搜索菜谱"})]})})]}),E&&N.length>0&&(0,n.jsx)("div",{ref:q,className:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",children:(0,n.jsx)("ul",{className:"py-1 divide-y divide-gray-100",children:N.map((e,t)=>(0,n.jsx)("li",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-700",onClick:()=>B(e),children:e},t))})}),g&&(0,n.jsx)("button",{type:"button",className:"absolute top-0 right-0 mt-2 mr-2 text-gray-500 hover:text-gray-700",onClick:x,children:(0,n.jsx)(o.Z,{size:20})})]})}},1409:function(e,t,r){r.d(t,{Vc:function(){return n}});function n(e){let t={...e,timestamp:Date.now()};console.log("User Action:",t);let r=JSON.parse(localStorage.getItem("user_actions")||"[]");r.push(t),localStorage.setItem("user_actions",JSON.stringify(r))}},2128:function(e,t,r){let n;r.d(t,{rf:function(){return i},xx:function(){return c}});var a=r(2436),s=r(2022);let l=s.env.NEXT_PUBLIC_SUPABASE_URL||"",o=s.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"";async function i(e){try{if(!e||e.trim().length<1)return[];let t=e.trim().toLowerCase(),r=new Set;console.log('搜索建议: 查询"'.concat(t,'"'));let a=!1;try{console.log("尝试使用RPC函数search_ingredients_and_seasonings");let{data:e,error:s}=await n.rpc("search_ingredients_and_seasonings",{search_term:t});s?console.error("SQL RPC搜索出错:",s):e&&Array.isArray(e)&&(e.forEach(e=>{e&&"string"==typeof e&&r.add(e)}),console.log("SQL RPC搜索返回".concat(e.length,"个结果")),a=r.size>0)}catch(e){console.error("SQL RPC函数调用异常:",e)}if(!a){console.log("RPC函数调用失败，尝试使用直接的SQL查询");try{let e="\n          WITH all_items AS (\n            -- 从食材中提取\n            SELECT name FROM (\n              SELECT DISTINCT jsonb_path_query(食材::jsonb, '$[*].名称') AS name \n              FROM \"CHrecipes\" \n              WHERE 食材::text ILIKE '%".concat(t,"%'\n              LIMIT 50\n            ) AS ingredients\n            WHERE name::text ILIKE '%").concat(t,"%'\n            \n            UNION\n            \n            -- 从调料中提取\n            SELECT name FROM (\n              SELECT DISTINCT jsonb_path_query(调料::jsonb, '$[*].名称') AS name \n              FROM \"CHrecipes\" \n              WHERE 调料::text ILIKE '%").concat(t,"%'\n              LIMIT 50\n            ) AS seasonings\n            WHERE name::text ILIKE '%").concat(t,"%'\n            \n            UNION\n            \n            -- 从菜名中提取\n            SELECT 菜名 AS name \n            FROM \"CHrecipes\" \n            WHERE 菜名 ILIKE '%").concat(t,"%'\n            LIMIT 20\n          )\n          \n          SELECT DISTINCT name::text\n          FROM all_items\n          WHERE name IS NOT NULL\n          LIMIT 30\n        "),{data:a,error:s}=await n.rpc("exec_sql",{sql_query:e});s?console.error("执行SQL查询出错:",s):a&&Array.isArray(a)&&(a.forEach(e=>{e&&e.name&&"string"==typeof e.name&&r.add(e.name)}),console.log("SQL查询返回".concat(a.length,"个结果")))}catch(e){console.error("执行SQL查询异常:",e)}}if(r.size<5){console.log("回退到分别查询食材、调料和菜名");try{let{data:e,error:a}=await n.from("CHrecipes").select("食材").ilike("食材::text","%".concat(t,"%")).limit(20);a?console.error("搜索食材时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.食材&&Array.isArray(e.食材)&&e.食材.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(t)&&r.add(e.名称)})}),console.log("食材搜索返回".concat(e.length,"个结果")))}catch(e){console.error("食材搜索异常:",e)}try{let{data:e,error:a}=await n.from("CHrecipes").select("调料").ilike("调料::text","%".concat(t,"%")).limit(20);a?console.error("搜索调料时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.调料&&Array.isArray(e.调料)&&e.调料.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(t)&&r.add(e.名称)})}),console.log("调料搜索返回".concat(e.length,"个结果")))}catch(e){console.error("调料搜索异常:",e)}try{let{data:e,error:a}=await n.from("CHrecipes").select("菜名").ilike("菜名","%".concat(t,"%")).limit(10);a?console.error("搜索菜名时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.菜名&&"string"==typeof e.菜名&&r.add(e.菜名)}),console.log("菜名搜索返回".concat(e.length,"个结果")))}catch(e){console.error("菜名搜索异常:",e)}}let s=Array.from(r).sort((e,r)=>{let n=e.toLowerCase(),a=r.toLowerCase();return n===t&&a!==t?-1:a===t&&n!==t?1:n.startsWith(t)&&!a.startsWith(t)?-1:a.startsWith(t)&&!n.startsWith(t)?1:n.includes(t)&&!a.includes(t)?-1:a.includes(t)&&!n.includes(t)?1:e.length-r.length});if(console.log("找到".concat(s.length,"个建议")),0===s.length)return["".concat(e),"".concat(e,"料理"),"".concat(e,"做法"),"家常".concat(e)];return s.slice(0,10)}catch(e){return console.error("获取关键词建议失败:",e),[]}}function c(e,t){if(!t.trim())return e;let r=function(e){if(!e)return[];let t=e.trim();for(let e of[" ",",","，",";","；"])" "!==e&&(t=t.split(e).join(" "));return t.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}(e),n=t.trim().toLowerCase();return r.some(e=>e.toLowerCase()===n)?e:e.trim()?"".concat(e.trim()," ").concat(t.trim()):t.trim()}n=(0,a.eI)(l,o)}}]);