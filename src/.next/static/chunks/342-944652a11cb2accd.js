"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[342],{3:function(e,t,n){n.d(t,{Ki:function(){return s}});var o=n(5467);function r(e,t){if(null==e)return t;if(Array.isArray(e))return e;if("string"==typeof e){if(""===e.trim())return t;try{return JSON.parse(e)}catch(t){return(0,o.KE)("DataMapper","safeParseJsonb","非JSON字符串值: ".concat(e)),[e]}}if("object"==typeof e)try{return e}catch(n){return(0,o.KE)("DataMapper","safeParseJsonb","无法处理的对象类型: ".concat(JSON.stringify(e))),t}return(0,o.KE)("DataMapper","safeParseJsonb","无法处理的值类型: ".concat(typeof e,", 值: ").concat(String(e))),t}function i(){return"temp-"+Date.now().toString(36)+Math.random().toString(36).substring(2,7)}function s(e){if(!Array.isArray(e))return(0,o.H)("DataMapper","transformDbRecipesToFrontend","接收到非数组输入: ".concat(typeof e),{value:e}),[];console.log("开始批量转换 ".concat(e.length," 个菜谱数据"));let t=[];for(let n=0;n<e.length;n++)try{if(!e[n]){(0,o.KE)("DataMapper","transformDbRecipesToFrontend","索引 ".concat(n," 处的数据为空"));continue}let s=function(e){try{let t=[];e.是否纯素&&t.push("纯素"),e.是否清真&&t.push("清真"),e.是否无麸质&&t.push("无麸质");let n=r(e.口味特点,[]),s=r(e.烹饪技法,[]),c=r(e.食材,[]),a=r(e.调料,[]),l=[],g=[],u=[];if("object"==typeof e.步骤&&null!==e.步骤){let t=e.步骤;t.hasOwnProperty("准备步骤")&&t.hasOwnProperty("烹饪步骤")?(l=Array.isArray(t["准备步骤"])?t["准备步骤"]:[],g=Array.isArray(t["烹饪步骤"])?t["烹饪步骤"]:[],u=[...l,...g]):g=u=r(e.步骤,[])}else g=u=r(e.步骤,[]);let f=r(e.注意事项,[]),d=30;if("number"==typeof e.烹饪时间)d=e.烹饪时间;else if("string"==typeof e.烹饪时间){let t=parseInt(e.烹饪时间,10);isNaN(t)||(d=t)}else if(e.烹饪时间&&"object"==typeof e.烹饪时间)try{let t=JSON.stringify(e.烹饪时间).match(/\d+/);t&&(d=parseInt(t[0],10))}catch(e){(0,o.KE)("DataMapper","transformDbToFrontend","无法解析烹饪时间: ".concat(e instanceof Error?e.message:String(e)))}return{id:e.id||i(),name:e.菜名||"未命名菜谱",cuisine:e.菜系||"其他",description:"",ingredients:c,seasonings:a,flavors:n,difficulty:e.烹饪难度||"中等",cookingTime:d,steps:u,preparationSteps:l,cookingSteps:g,tips:f,imageUrl:"/images/placeholder-food.jpg",cookingMethod:s,dietaryRestrictions:t,tags:[]}}catch(t){return(0,o.H)("DataMapper","transformDbToFrontend",t,{recipeId:null==e?void 0:e.id}),{id:(null==e?void 0:e.id)||i(),name:(null==e?void 0:e.菜名)||"转换错误的菜谱",cuisine:"其他",description:"数据转换过程中发生错误",ingredients:[],seasonings:[],flavors:[],difficulty:"简单",cookingTime:30,steps:[],preparationSteps:[],cookingSteps:[],tips:[],imageUrl:"/images/placeholder-food.jpg",cookingMethod:[],dietaryRestrictions:[],tags:[]}}}(e[n]);t.push(s)}catch(t){(0,o.H)("DataMapper","transformDbRecipesToFrontend",t,{index:n,data:e[n]?{id:e[n].id,name:e[n].菜名}:null})}return console.log("批量转换完成，成功转换 ".concat(t.length," / ").concat(e.length," 个菜谱")),t}},5467:function(e,t,n){n.d(t,{H:function(){return s},KE:function(){return c},NB:function(){return u},PN:function(){return a},T1:function(){return g},eX:function(){return d},iB:function(){return l},mt:function(){return f}});let o=[],r=[],i=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),s=(e,t,n,r)=>{let s="string"==typeof n?n:n.message,c="string"==typeof n?void 0:n.stack,a="string"==typeof n?"CustomError":n.name,l={id:i(),timestamp:new Date().toISOString(),type:a,message:s,component:e,operation:t,severity:"error",details:r,stack:c};return o.unshift(l),o.length>50&&(o=o.slice(0,50)),console.error("[".concat(e,"][").concat(t,"] ").concat(s),r||""),l.id},c=(e,t,n,r)=>{let s={id:i(),timestamp:new Date().toISOString(),type:"Warning",message:n,component:e,operation:t,severity:"warning",details:r};return o.unshift(s),o.length>50&&(o=o.slice(0,50)),console.warn("[".concat(e,"][").concat(t,"] ").concat(n),r||""),s.id},a=(e,t,n,r)=>{let s={id:i(),timestamp:new Date().toISOString(),type:"Info",message:n,component:e,operation:t,severity:"info",details:r};return o.unshift(s),o.length>50&&(o=o.slice(0,50)),console.info("[".concat(e,"][").concat(t,"] ").concat(n),r||""),s.id},l=(e,t,n)=>{let o={id:i(),timestamp:new Date().toISOString(),lastComponent:e,lastAction:t,lastData:n};return r.unshift(o),r.length>20&&(r=r.slice(0,20)),o.id},g=()=>[...o],u=()=>[...r],f=()=>{o=[]},d=()=>{r=[]}},8996:function(e,t,n){n.d(t,{x:function(){return o}});function o(){return[{id:"1",name:"红烧肉",description:"经典的中式菜肴，肥而不腻，口感醇厚。",ingredients:["五花肉","姜","蒜","葱","冰糖"],seasonings:["生抽","老抽","料酒","八角","桂皮"],flavors:["咸鲜","甜"],difficulty:"中等",cookingTime:60,steps:["五花肉切成大块，冷水下锅焯水去血沫","锅中放少量油，加入冰糖小火炒至融化呈棕色","放入焯好的五花肉翻炒均匀上色","加入姜片、蒜瓣、八角、桂皮等香料","倒入生抽、老抽、料酒，加水没过肉","大火烧开后转小火慢炖1小时","最后收汁，撒上葱花即可"],preparationSteps:["五花肉洗净切成4厘米见方的块","准备好所有调料和配料"],tips:["焯水时加入料酒可以去腥","炖煮时间越长肉越烂","可以加入适量白萝卜，吸收肉的香味"],imageUrl:"/images/hongshaorou.jpg",tags:["家常菜","红烧","肉类"],cuisine:"川菜",cookingMethod:["炖","烧"],dietaryRestrictions:[]},{id:"2",name:"西红柿炒鸡蛋",description:"家常快手菜，酸甜可口，简单美味。",ingredients:["西红柿","鸡蛋","葱"],seasonings:["盐","白糖","食用油"],flavors:["酸甜"],difficulty:"简单",cookingTime:15,steps:["西红柿洗净切块，葱切段","鸡蛋打散，加少许盐搅匀","热锅冷油，倒入蛋液炒至金黄盛出","锅中留底油，放入葱段爆香","加入西红柿块翻炒至出汁","加入少许白糖提鲜","倒入炒好的鸡蛋一起翻炒均匀","加盐调味即可"],preparationSteps:["西红柿洗净切成块","鸡蛋打散加少许盐搅匀"],tips:["西红柿炒鸡蛋的顺序是先炒鸡蛋再炒西红柿","加入少量白糖可以中和西红柿的酸味","不喜欢酸味可以选择完全成熟的西红柿"],imageUrl:"/images/fanqiejidan.jpg",tags:["家常菜","快手菜","素菜"],cuisine:"家常菜",cookingMethod:["炒"],dietaryRestrictions:["纯素"]},{id:"3",name:"水煮鱼",description:"四川传统名菜，麻辣鲜香，口感滑嫩。",ingredients:["草鱼","豆芽","生菜","花椒","干辣椒"],seasonings:["郫县豆瓣酱","生抽","料酒","姜","蒜","盐","鸡精"],flavors:["麻辣"],difficulty:"中等",cookingTime:40,steps:["草鱼去鳞去内脏，切片，加盐、料酒、淀粉腌制15分钟","锅中水烧开，加入豆芽和生菜焯水后捞出铺盘底","另起锅，油温6成热放入花椒和干辣椒爆香","加入郫县豆瓣酱炒出红油","加入姜末、蒜末炒香","加入适量清水，放入腌好的鱼片","水开后撇去浮沫，加入盐、鸡精调味","出锅前浇上热油，撒上香菜"],preparationSteps:["草鱼处理干净切片","豆芽和生菜洗净","准备花椒、干辣椒等调料"],tips:["鱼片切得薄一些，容易入味且熟得快","鱼片下锅后不要用力搅动，以免破坏鱼肉结构","最后淋热油可以增香提味"],imageUrl:"/images/shuizhuyu.jpg",tags:["川菜","水煮","鱼"],cuisine:"川菜",cookingMethod:["煮"],dietaryRestrictions:[]},{id:"4",name:"宫保鸡丁",description:"经典川菜，鸡肉鲜嫩，花生香脆，甜辣适中。",ingredients:["鸡胸肉","花生米","干辣椒","花椒","葱","姜","蒜"],seasonings:["生抽","醋","白糖","料酒","淀粉","盐"],flavors:["麻辣","甜酸"],difficulty:"中等",cookingTime:30,steps:["鸡胸肉切丁，用生抽、料酒、盐、淀粉腌制15分钟","花生米提前用油炸熟或者干炒熟","干辣椒切段，葱姜蒜切末","锅热油温5成热，放入花椒和干辣椒炒香","加入葱姜蒜爆香","放入腌好的鸡丁翻炒至变色","加入生抽、醋、白糖、盐调味","勾芡收汁，加入炒熟的花生米拌匀即可"],preparationSteps:["鸡胸肉切丁并腌制","花生米炒熟","准备好调料"],tips:["鸡肉不要过度搅拌，以免出水影响口感","如果喜欢辣一些，可以增加干辣椒的量","最后收汁时火候要大，速度要快"],imageUrl:"/images/gongbaojiding.jpg",tags:["川菜","炒菜","鸡肉"],cuisine:"川菜",cookingMethod:["炒"],dietaryRestrictions:[]},{id:"5",name:"糖醋排骨",description:"经典汉族名菜，酸甜可口，排骨酥烂。",ingredients:["猪小排","姜","蒜","葱","白芝麻"],seasonings:["生抽","醋","白糖","料酒","番茄酱","淀粉"],flavors:["酸甜"],difficulty:"中等",cookingTime:45,steps:["猪小排洗净切段，焯水去血沫","锅中放油，放入姜片、蒜瓣爆香","加入焯好的排骨翻炒上色","加入生抽、料酒翻炒均匀","加入适量清水、白糖、醋、番茄酱","大火烧开后转小火炖至排骨酥烂","大火收汁，撒上葱花和白芝麻"],preparationSteps:["猪小排洗净切段","准备好各种调料"],tips:["焯水时加入料酒可以去腥","糖醋汁的比例可以根据个人口味调整","收汁时不要盖锅盖，以便让汤汁更好地收浓"],imageUrl:"/images/tangcupaigu.jpg",tags:["家常菜","糖醋","排骨"],cuisine:"鲁菜",cookingMethod:["炖","烧"],dietaryRestrictions:[]},{id:"6",name:"清蒸鲈鱼",description:"经典粤菜，鲜香嫩滑，保留了鱼的原汁原味。",ingredients:["鲈鱼","姜","蒜","葱","红辣椒"],seasonings:["生抽","盐","料酒","香油"],flavors:["鲜香"],difficulty:"中等",cookingTime:25,steps:["鲈鱼宰杀干净，去鳞去内脏，在两面各划几刀","鱼身抹上盐和料酒腌制10分钟去腥","葱姜蒜切丝，红辣椒切圈","将葱姜蒜一部分铺在盘底，鱼放上去","锅中水烧开，放入装有鱼的盘子，大火蒸8-10分钟","取出后撒上剩余的葱姜蒜和辣椒圈","锅中热油，浇在葱姜蒜上","淋上生抽和香油即可"],preparationSteps:["鲈鱼处理干净","准备好各种配料"],tips:["选择新鲜的鲈鱼更加鲜美","蒸鱼的时间不能过长，以免肉质过老","最后淋上热油能激发出葱姜蒜的香味"],imageUrl:"/images/qingzhengluyu.jpg",tags:["粤菜","蒸菜","鱼"],cuisine:"粤菜",cookingMethod:["蒸"],dietaryRestrictions:[]}]}},342:function(e,t,n){let o;n.d(t,{createUserFeedbackTable:function(){return E},ZY:function(){return k},Z2:function(){return m},s8:function(){return b},OQ:function(){return y}});var r=n(2436),i=n(8996);let s="recipes",c="collections";async function a(){return new Promise((e,t)=>{if(!("indexedDB"in window)){t(Error("浏览器不支持IndexedDB"));return}let n=indexedDB.open("RecipeFinderDB",1);n.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(s)){let e=t.createObjectStore(s,{keyPath:"id"});e.createIndex("菜名","name",{unique:!1}),e.createIndex("菜系","cuisine",{unique:!1}),e.createIndex("烹饪难度","difficulty",{unique:!1})}t.objectStoreNames.contains(c)||t.createObjectStore(c,{keyPath:"id"})},n.onsuccess=t=>{e(t.target.result)},n.onerror=e=>{t(Error("数据库打开失败: ".concat(e.target.error)))}})}async function l(e){try{let t=(await a()).transaction(s,"readwrite"),n=t.objectStore(s);return e.forEach(e=>{n.put(e)}),new Promise((n,o)=>{t.oncomplete=()=>{console.log("成功缓存 ".concat(e.length," 个菜谱")),n()},t.onerror=e=>{o(Error("缓存菜谱失败: ".concat(e.target.error)))}})}catch(e){throw console.error("缓存菜谱时出错:",e),e}}async function g(e){try{let t=(await a()).transaction(s,"readonly").objectStore(s).get(e);return new Promise((n,o)=>{t.onsuccess=()=>{n(t.result||null)},t.onerror=()=>{o(Error("获取ID为".concat(e,"的菜谱失败: ").concat(t.error)))}})}catch(t){return console.error("获取ID为".concat(e,"的缓存菜谱时出错:"),t),null}}var u=n(3),f=n(2022);let d=f.env.NEXT_PUBLIC_SUPABASE_URL||"https://ijwimydlumbolmpnmezt.supabase.co",p=f.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2lteWRsdW1ib2xtcG5tZXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NjExMDUsImV4cCI6MjA1ODAzNzEwNX0.ynhuFYG6dkoxDgEyDwEnWdZ-DRWx3illLZGyYwn_UnA";console.log("初始化Supabase客户端:"),console.log("- URL:",d),console.log("- 使用默认值:","https://ijwimydlumbolmpnmezt.supabase.co"===d?"是":"否"),console.log("- 密钥长度:",p?p.length:"未设置");try{o=(0,r.eI)(d,p,{auth:{autoRefreshToken:!0,persistSession:!0},global:{fetch:(e,t)=>{let n=setTimeout(()=>{console.error("Supabase请求超时:",e)},1e4);return fetch(e,{...t,signal:AbortSignal.timeout(15e3)}).then(e=>(clearTimeout(n),e)).catch(e=>{throw clearTimeout(n),console.error("Supabase请求错误:",e),e})}}}),console.log("Supabase客户端创建成功")}catch(e){console.error("创建Supabase客户端时出错:",e),o=(0,r.eI)(d,p)}let y=o;function h(e,t){if(!t||0===t.length)throw Error("必须提供至少一个搜索字段");let n=t.map(t=>{let n=t.includes(".")||/[\u4e00-\u9fa5]/.test(t)||t.match(/^(id|all|table|column|database|from|to|select|where|order|by|or|and|not|if|else)$/i)?'"'.concat(t,'"'):t;return"".concat(n,".ilike.%").concat(e,"%")});return"(".concat(n.join(","),")")}async function m(e){try{console.log("使用筛选条件从Supabase加载菜谱数据...",e);let t=y.from("CHrecipes").select("*");if(e.cuisine&&(t=t.eq("菜系",e.cuisine),console.log("添加菜系筛选: ".concat(e.cuisine))),e.difficulty&&(t=t.eq("烹饪难度",e.difficulty),console.log("添加难度筛选: ".concat(e.difficulty))),e.dietaryRestrictions&&e.dietaryRestrictions.length>0)for(let n of(console.log("添加饮食限制筛选: ".concat(e.dietaryRestrictions.join(", "))),e.dietaryRestrictions))"纯素"===n?(t=t.eq("是否纯素",!0),console.log("添加纯素筛选条件")):"清真"===n?(t=t.eq("是否清真",!0),console.log("添加清真筛选条件")):"无麸质"===n&&(t=t.eq("是否无麸质",!0),console.log("添加无麸质筛选条件"));let n=[],o=0,r=!0;for(;r;){let e=1e3*o,i=e+1e3-1;console.log("加载筛选菜谱批次 ".concat(o+1,"，范围 ").concat(e,"-").concat(i));let{data:s,error:c}=await t.range(e,i);if(c){console.error("加载筛选菜谱批次 ".concat(o+1," 出错:"),c);break}if(!s||0===s.length){console.log("筛选批次 ".concat(o+1," 未返回任何数据，加载完成")),r=!1;break}console.log("筛选批次 ".concat(o+1," 加载了 ").concat(s.length," 条菜谱")),n=[...n,...s],s.length<1e3?(console.log("筛选批次 ".concat(o+1," 数据量少于每页数量，加载完成")),r=!1):o++}console.log("从Supabase加载了 ".concat(n.length," 个菜谱"));let i=(0,u.Ki)(n);return e.ingredients&&e.ingredients.length>0&&(console.log("在客户端按食材筛选: ".concat(e.ingredients.join(", "))),i=i.filter(t=>e.ingredients.some(e=>Array.isArray(t.ingredients)&&t.ingredients.some(t=>"string"==typeof t&&t.toLowerCase().includes(e.toLowerCase())))),console.log("按食材筛选后剩余 ".concat(i.length," 个菜谱"))),e.taste&&(console.log("在客户端按口味筛选: ".concat(e.taste)),i=i.filter(t=>Array.isArray(t.flavors)&&t.flavors.includes(e.taste)),console.log("按口味筛选后剩余 ".concat(i.length," 个菜谱"))),e.cookingMethod&&(console.log("在客户端按烹饪方式筛选: ".concat(e.cookingMethod)),i=i.filter(t=>t.cookingMethod&&(Array.isArray(t.cookingMethod)?t.cookingMethod.includes(e.cookingMethod):t.cookingMethod===e.cookingMethod)),console.log("按烹饪方式筛选后剩余 ".concat(i.length," 个菜谱"))),console.log("筛选后得到 ".concat(i.length," 个菜谱")),i}catch(n){console.error("筛选菜谱数据失败:",n),console.log("远程筛选失败:",n),console.log("尝试使用示例数据进行客户端筛选...");let t=[...(0,i.x)()];return e.cuisine&&(t=t.filter(t=>t.cuisine===e.cuisine)),e.difficulty&&(t=t.filter(t=>t.difficulty===e.difficulty)),e.ingredients&&e.ingredients.length>0&&(t=t.filter(t=>e.ingredients.some(e=>Array.isArray(t.ingredients)&&t.ingredients.some(t=>t.toLowerCase().includes(e.toLowerCase()))))),e.taste&&(t=t.filter(t=>Array.isArray(t.flavors)&&t.flavors.includes(e.taste))),e.cookingMethod&&(t=t.filter(t=>t.cookingMethod&&(Array.isArray(t.cookingMethod)?t.cookingMethod.includes(e.cookingMethod):t.cookingMethod===e.cookingMethod))),e.dietaryRestrictions&&e.dietaryRestrictions.length>0&&(t=t.filter(t=>{let n=Array.isArray(t.dietaryRestrictions)?t.dietaryRestrictions:[];return e.dietaryRestrictions.some(e=>n.includes(e))})),console.log("示例数据筛选后得到 ".concat(t.length," 个菜谱")),t}}async function k(e){try{try{let t=await g(e);if(t)return console.log("从缓存获取菜谱ID: ".concat(e," (").concat(t.name,")")),t}catch(e){console.warn("从缓存获取菜谱失败，尝试从服务器获取:",e)}console.log("尝试从Supabase获取菜谱ID: ".concat(e));let{data:t,error:n}=await y.from("CHrecipes").select("*").eq("id",e).single();if(n)throw console.error("获取菜谱详情错误:",n),n;if(t)try{let n=(0,u.Ki)([t])[0],o={...n,flavors:n.flavors,difficulty:n.difficulty,cuisine:n.cuisine,cookingMethod:n.cookingMethod,dietaryRestrictions:n.dietaryRestrictions};await l([o]),console.log("菜谱 ".concat(e," 已保存到缓存"))}catch(e){console.error("缓存单个菜谱失败:",e)}return(0,u.Ki)([t])[0]}catch(n){console.error("获取ID为 ".concat(e," 的菜谱失败:"),n);let t=(0,i.x)().find(t=>t.id===e);if(t)return console.log("从示例数据获取菜谱ID: ".concat(e," (").concat(t.name,")")),t;return null}}async function b(e){try{console.log('在Supabase搜索菜谱: "'.concat(e,'"'));let t=e.split(/\s+/).filter(e=>""!==e.trim());if(console.log("检测到".concat(t.length,"个搜索关键词:"),t),0===t.length)return console.log("搜索词为空，返回空结果"),[];let n=["菜名","步骤","食材"],o=[],r=0,i=!0,s=y.from("CHrecipes").select("*");if(1===t.length){console.log("构建多字段搜索查询，字段: ".concat(n.join(", ")));let e=h(t[0],n);console.log("生成的OR查询条件: ".concat(e)),s=s.or(e)}else console.log("多关键词搜索模式，应用AND逻辑"),t.forEach((e,t)=>{let o=h(e,n);0===t&&(s=s.or(o))});for(;i;){let e=1e3*r,n=e+1e3-1;console.log("加载搜索菜谱批次 ".concat(r+1,"，范围 ").concat(e,"-").concat(n));let{data:c,error:a}=await s.range(e,n);if(a){console.error("加载搜索菜谱批次 ".concat(r+1," 出错:"),a);break}if(!c||0===c.length){console.log("搜索批次 ".concat(r+1," 未返回任何数据，加载完成")),i=!1;break}if(console.log("搜索批次 ".concat(r+1," 加载了 ").concat(c.length," 条菜谱")),t.length>1){let e=c.filter(e=>{let n=((e.菜名||"")+" "+(e.步骤||"")+" "+(e.食材||"")).toLowerCase();return t.every(e=>n.includes(e.toLowerCase()))});console.log("批次 ".concat(r+1," 筛选后得到 ").concat(e.length," 条符合所有关键词的菜谱")),o=[...o,...e]}else o=[...o,...c];c.length<1e3?(console.log("搜索批次 ".concat(r+1," 数据量少于每页数量，加载完成")),i=!1):r++}console.log("搜索出 ".concat(o.length," 个菜谱"));let c=(0,u.Ki)(o);return c=function(e,t){let n=t.toLowerCase();return[...e].sort((e,t)=>{let o=w(e,n);return w(t,n)-o})}(c,e)}catch(r){console.error("搜索菜谱出错:",r),console.log("尝试在示例数据中搜索:",e);let t=(0,i.x)(),n=e.split(/\s+/).filter(e=>""!==e.trim()),o=t.filter(t=>{let o=((t.name||"")+" "+(t.description||"")+" "+(Array.isArray(t.ingredients)?t.ingredients.join(" "):"")).toLowerCase();return n.length>1?n.every(e=>o.includes(e.toLowerCase())):o.includes(e.toLowerCase())});return console.log("示例数据中找到 ".concat(o.length," 个匹配菜谱")),o}}function w(e,t){let n=0,o=t.toLowerCase().trim();if(!o)return 0;let r=o.split(/\s+/).filter(Boolean),i=[];for(let t of r){let n=0,o=e.name?e.name.toLowerCase():"";if(o.includes(t)&&(n+=15,o===t?n+=5:o.startsWith(t)&&(n+=3),o.length>0)){let e=Math.min(t.length/o.length,1);n+=2*e}if(e.ingredients&&Array.isArray(e.ingredients)){let o=e.ingredients.filter(e=>{let n="";return"string"==typeof e?n=e.toLowerCase():"object"==typeof e&&null!==e&&(n=(e.name||e.名称||"").toLowerCase()),n&&n.includes(t)});if(o.length>0){n+=12,o.some(e=>{let n="";return"string"==typeof e?n=e.toLowerCase():"object"==typeof e&&null!==e&&(n=(e.name||e.名称||"").toLowerCase()),n===t})&&(n+=3);let r=Math.min(o.length/e.ingredients.length,1);n+=3*r}}if(e.seasonings&&Array.isArray(e.seasonings)){let o=e.seasonings.filter(e=>{let n="";return"string"==typeof e?n=e.toLowerCase():"object"==typeof e&&null!==e&&(n=(e.name||e.名称||"").toLowerCase()),n&&n.includes(t)});o.length>0&&(n+=8,o.some(e=>{let n="";return"string"==typeof e?n=e.toLowerCase():"object"==typeof e&&null!==e&&(n=(e.name||e.名称||"").toLowerCase()),n===t})&&(n+=2))}let r=!1,s=e=>{for(let o of e)if("string"==typeof o&&o.toLowerCase().includes(t)){n+=6,r=!0;break}};if(e.cookingSteps&&Array.isArray(e.cookingSteps)&&s(e.cookingSteps),!r&&e.steps&&Array.isArray(e.steps)&&s(e.steps),!r&&e.preparationSteps&&Array.isArray(e.preparationSteps)&&s(e.preparationSteps),e.cuisine&&"string"==typeof e.cuisine){let o=e.cuisine.toLowerCase();o.includes(t)&&(n+=4,o===t&&(n+=1))}if(e.cookingMethod&&Array.isArray(e.cookingMethod)){for(let o of e.cookingMethod)if("string"==typeof o&&o.toLowerCase().includes(t)){n+=4,o.toLowerCase()===t&&(n+=1);break}}if(e.flavors&&Array.isArray(e.flavors)){for(let o of e.flavors)if("string"==typeof o&&o.toLowerCase().includes(t)){n+=3,o.toLowerCase()===t&&(n+=1);break}}e.difficulty&&"string"==typeof e.difficulty&&e.difficulty.toLowerCase().includes(t)&&(n+=2),i.push(n)}if(i.length>0&&(n=i.reduce((e,t)=>e+t,0),i.length>1)){let e=.05*(i.length-1)*n;n+=e}return console.log('菜谱"'.concat(e.name,'"的相关性得分: ').concat(n.toFixed(2))),n}async function E(){try{console.log("尝试创建user_feedback表...");let{error:e}=await y.rpc("execute_sql",{sql:"\n        CREATE TABLE IF NOT EXISTS user_feedback (\n          id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n          name TEXT NOT NULL,\n          email TEXT NOT NULL,\n          subject TEXT NOT NULL,\n          message TEXT NOT NULL,\n          status TEXT DEFAULT 'new',\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n        );\n        \n        -- 创建RLS策略\n        ALTER TABLE user_feedback ENABLE ROW LEVEL SECURITY;\n        \n        -- 允许匿名插入\n        CREATE POLICY \"Allow anonymous inserts\" ON user_feedback\n        FOR INSERT WITH CHECK (true);\n        \n        -- 创建辅助函数\n        CREATE OR REPLACE FUNCTION create_user_feedback_table()\n        RETURNS void\n        LANGUAGE plpgsql\n        SECURITY DEFINER\n        AS $$\n        BEGIN\n          -- 表已通过上面的语句创建，此函数仅作为调用入口\n          NULL;\n        END;\n        $$;\n        \n        -- 授予匿名用户执行权限\n        GRANT EXECUTE ON FUNCTION create_user_feedback_table TO anon;\n      "});if(e)throw e;return console.log("成功创建user_feedback表"),!0}catch(e){return console.error("创建user_feedback表失败:",e),!1}}setTimeout(()=>{E()},5e3)}}]);