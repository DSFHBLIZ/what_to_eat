(()=>{var e={};e.id=534,e.ids=[534],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},4993:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>m,tree:()=>c});var s=t(7),a=t(8533),o=t(9377),n=t.n(o),i=t(9799),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);t.d(r,l);let c=["",{children:["debug",{children:["search-test",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,1122)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\debug\\search-test\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,5421)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,3015)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,7832)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\not-found.tsx"]}],u=["D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\debug\\search-test\\page.tsx"],d="/debug/search-test/page",p={require:t,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/debug/search-test/page",pathname:"/debug/search-test",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3777:(e,r,t)=>{Promise.resolve().then(t.bind(t,8075))},8075:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var s=t(4714),a=t(7580),o=t(6154);function n(){let[e,r]=(0,a.useState)(""),[t,n]=(0,a.useState)([]),[i,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let r=setTimeout(async()=>{if(!e.trim()){n([]);return}l(!0),u(null);try{let r=await (0,o.rf)(e);n(r)}catch(e){console.error("获取建议时出错:",e),u("获取建议失败")}finally{l(!1)}},300);return()=>clearTimeout(r)},[e]),(0,s.jsxs)("div",{className:"p-8 max-w-4xl mx-auto",children:[s.jsx("h1",{className:"text-2xl font-bold mb-6",children:"搜索推荐测试"}),(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("label",{htmlFor:"search",className:"block mb-2 text-sm font-medium",children:"搜索关键词"}),s.jsx("input",{id:"search",type:"text",value:e,onChange:e=>r(e.target.value),placeholder:"输入关键词...",className:"w-full p-3 border border-gray-300 rounded-lg"})]}),i&&s.jsx("p",{className:"text-gray-500",children:"加载中..."}),c&&s.jsx("p",{className:"text-red-500",children:c}),!i&&t.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"搜索建议:"}),s.jsx("ul",{className:"border rounded-lg overflow-hidden",children:t.map((e,t)=>s.jsx("li",{className:"p-3 border-b last:border-b-0 hover:bg-gray-50 cursor-pointer",onClick:()=>r(e),children:e},t))})]}),!i&&e&&0===t.length&&s.jsx("p",{className:"text-gray-500",children:"没有找到相关建议"}),(0,s.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"调试信息"}),s.jsx("pre",{className:"text-xs bg-gray-100 p-3 rounded overflow-auto max-h-[300px]",children:JSON.stringify({query:e,suggestions:t,loading:i,error:c},null,2)})]})]})}},6154:(e,r,t)=>{"use strict";let s;async function a(e){try{if(!e||e.trim().length<1)return[];let r=e.trim().toLowerCase(),t=new Set;console.log(`搜索建议: 查询"${r}"`);let a=!1;try{console.log("尝试使用RPC函数search_ingredients_and_seasonings");let{data:e,error:o}=await s.rpc("search_ingredients_and_seasonings",{search_term:r});o?console.error("SQL RPC搜索出错:",o):e&&Array.isArray(e)&&(e.forEach(e=>{e&&"string"==typeof e&&t.add(e)}),console.log(`SQL RPC搜索返回${e.length}个结果`),a=t.size>0)}catch(e){console.error("SQL RPC函数调用异常:",e)}if(!a){console.log("RPC函数调用失败，尝试使用直接的SQL查询");try{let e=`
          WITH all_items AS (
            -- 从食材中提取
            SELECT name FROM (
              SELECT DISTINCT jsonb_path_query(食材::jsonb, '$[*].名称') AS name 
              FROM "CHrecipes" 
              WHERE 食材::text ILIKE '%${r}%'
              LIMIT 50
            ) AS ingredients
            WHERE name::text ILIKE '%${r}%'
            
            UNION
            
            -- 从调料中提取
            SELECT name FROM (
              SELECT DISTINCT jsonb_path_query(调料::jsonb, '$[*].名称') AS name 
              FROM "CHrecipes" 
              WHERE 调料::text ILIKE '%${r}%'
              LIMIT 50
            ) AS seasonings
            WHERE name::text ILIKE '%${r}%'
            
            UNION
            
            -- 从菜名中提取
            SELECT 菜名 AS name 
            FROM "CHrecipes" 
            WHERE 菜名 ILIKE '%${r}%'
            LIMIT 20
          )
          
          SELECT DISTINCT name::text
          FROM all_items
          WHERE name IS NOT NULL
          LIMIT 30
        `,{data:a,error:o}=await s.rpc("exec_sql",{sql_query:e});o?console.error("执行SQL查询出错:",o):a&&Array.isArray(a)&&(a.forEach(e=>{e&&e.name&&"string"==typeof e.name&&t.add(e.name)}),console.log(`SQL查询返回${a.length}个结果`))}catch(e){console.error("执行SQL查询异常:",e)}}if(t.size<5){console.log("回退到分别查询食材、调料和菜名");try{let{data:e,error:a}=await s.from("CHrecipes").select("食材").ilike("食材::text",`%${r}%`).limit(20);a?console.error("搜索食材时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.食材&&Array.isArray(e.食材)&&e.食材.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(r)&&t.add(e.名称)})}),console.log(`食材搜索返回${e.length}个结果`))}catch(e){console.error("食材搜索异常:",e)}try{let{data:e,error:a}=await s.from("CHrecipes").select("调料").ilike("调料::text",`%${r}%`).limit(20);a?console.error("搜索调料时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.调料&&Array.isArray(e.调料)&&e.调料.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(r)&&t.add(e.名称)})}),console.log(`调料搜索返回${e.length}个结果`))}catch(e){console.error("调料搜索异常:",e)}try{let{data:e,error:a}=await s.from("CHrecipes").select("菜名").ilike("菜名",`%${r}%`).limit(10);a?console.error("搜索菜名时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.菜名&&"string"==typeof e.菜名&&t.add(e.菜名)}),console.log(`菜名搜索返回${e.length}个结果`))}catch(e){console.error("菜名搜索异常:",e)}}let o=Array.from(t).sort((e,t)=>{let s=e.toLowerCase(),a=t.toLowerCase();return s===r&&a!==r?-1:a===r&&s!==r?1:s.startsWith(r)&&!a.startsWith(r)?-1:a.startsWith(r)&&!s.startsWith(r)?1:s.includes(r)&&!a.includes(r)?-1:a.includes(r)&&!s.includes(r)?1:e.length-t.length});if(console.log(`找到${o.length}个建议`),0===o.length)return[`${e}`,`${e}料理`,`${e}做法`,`家常${e}`];return o.slice(0,10)}catch(e){return console.error("获取关键词建议失败:",e),[]}}function o(e,r){if(!r.trim())return e;let t=function(e){if(!e)return[];let r=e.trim();for(let e of[" ",",","，",";","；"])" "!==e&&(r=r.split(e).join(" "));return r.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}(e),s=r.trim().toLowerCase();return t.some(e=>e.toLowerCase()===s)?e:e.trim()?`${e.trim()} ${r.trim()}`:r.trim()}t.d(r,{rf:()=>a,xx:()=>o}),t(8384),process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,console.log("静态构建环境检测到，使用模拟的Supabase客户端在keywordUtils中"),s={rpc:()=>({execute:async()=>({data:[],error:null})}),from:()=>({select:()=>({ilike:()=>({execute:async()=>({data:[],error:null})}),textSearch:()=>({execute:async()=>({data:[],error:null})}),execute:async()=>({data:[],error:null})})})}},1122:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>o,__esModule:()=>a,default:()=>n});let s=(0,t(1481).createProxy)(String.raw`D:\test\Cursor\What_to_eat_Web\src\app\debug\search-test\page.tsx`),{__esModule:a,$$typeof:o}=s,n=s.default}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[499,843,384,242],()=>t(4993));module.exports=s})();