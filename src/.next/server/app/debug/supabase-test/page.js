(()=>{var e={};e.id=838,e.ids=[838],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},403:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>c});var r=t(7),a=t(8533),o=t(9377),n=t.n(o),i=t(9799),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);t.d(s,l);let c=["",{children:["debug",{children:["supabase-test",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3223)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\debug\\supabase-test\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,5421)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\layout.tsx"],error:[()=>Promise.resolve().then(t.bind(t,3015)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\error.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,7832)),"D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\not-found.tsx"]}],u=["D:\\test\\Cursor\\What_to_eat_Web\\src\\app\\debug\\supabase-test\\page.tsx"],d="/debug/supabase-test/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/debug/supabase-test/page",pathname:"/debug/supabase-test",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},372:(e,s,t)=>{Promise.resolve().then(t.bind(t,74))},74:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var r=t(4714),a=t(7580),o=t(9872),n=t(8384),i=t(2615);function l(){let[e,s]=(0,a.useState)([]),[t,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)({hasKey:!1,initialized:!1}),d=()=>{try{console.log("初始化Supabase客户端...");let e=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://ijwimydlumbolmpnmezt.supabase.co",s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2lteWRsdW1ib2xtcG5tZXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NjExMDUsImV4cCI6MjA1ODAzNzEwNX0.ynhuFYG6dkoxDgEyDwEnWdZ-DRWx3illLZGyYwn_UnA";if(!e)throw Error("Supabase URL未设置");if(!s)throw Error("Supabase密钥未设置");console.log("Supabase配置信息:"),console.log("- URL:",e),console.log("- 密钥:",s.substring(0,10)+"..."),u({url:e,hasKey:!!s,initialized:!0});let t=(0,n.eI)(e,s,{auth:{autoRefreshToken:!0,persistSession:!0},global:{fetch:(e,s)=>(console.log("发起Supabase请求:",e),fetch(e,{...s,signal:AbortSignal.timeout(15e3)}).catch(e=>{throw console.error("Supabase请求错误:",e),e}))}});return console.log("Supabase客户端初始化成功"),t}catch(e){throw console.error("初始化Supabase客户端失败:",e),(0,i.H)("SupabaseTestPage","initSupabase",e),m({name:"Supabase初始化",status:"error",message:`初始化失败: ${e.message}`,details:{error:e}}),e}},m=e=>{s(s=>[...s,e])},p=async()=>{l(!0),s([]);try{(0,i.PN)("SupabaseTestPage","runAllTests","开始Supabase连接测试"),(0,i.iB)("SupabaseTestPage","开始测试",{timestamp:new Date().toISOString()});let s=d();await x(s),await g(s),await h(s),await b(s),await f(s),(0,i.PN)("SupabaseTestPage","runAllTests","所有测试完成",{totalTests:e.length,successCount:e.filter(e=>"success"===e.status).length,errorCount:e.filter(e=>"error"===e.status).length})}catch(e){(0,i.H)("SupabaseTestPage","runAllTests",e),m({name:"测试初始化",status:"error",message:`测试过程中发生错误: ${e.message}`})}finally{l(!1)}},x=async e=>{let s=performance.now();try{m({name:"基础连接测试",status:"pending",message:"正在测试Supabase连接..."}),console.log("开始Supabase连接测试..."),console.log("使用URL:",e.supabaseUrl),console.log("尝试向CHrecipes表发送简单查询...");let{data:t,error:r}=await e.from("CHrecipes").select("id").limit(1);console.log("查询响应:",{data:t,error:r});let a=performance.now()-s;if(r)throw console.error("连接测试失败，详细错误:",r),r;if(!t)throw console.warn("连接测试返回空数据"),Error("连接成功但返回空数据");m({name:"基础连接测试",status:"success",message:"成功连接到Supabase服务器",duration:a,details:{data:t,responseTime:`${a.toFixed(2)}ms`}})}catch(o){let e=performance.now();console.error("Supabase连接失败，详细错误:",o);let t=o?.message||"未知错误",r=o?.code||"UNKNOWN",a=o?.details||"";(0,i.H)("SupabaseTestPage","testConnection",o),m({name:"基础连接测试",status:"error",message:`连接失败: ${t}`,duration:e-s,details:{error:o,errorCode:r,errorMessage:t,errorDetails:a,troubleshooting:"请检查Supabase URL和密钥是否正确，以及网络连接是否正常"}})}},g=async e=>{let s=performance.now();try{m({name:"表结构测试",status:"pending",message:"正在获取表结构..."});let t=[];t.push({label:"start",time:performance.now()}),console.log("开始表结构测试 - 终极性能版..."),t.push({label:"query_start",time:performance.now()});let r=await e.from("CHrecipes").select("count()",{count:"exact",head:!0}).limit(1);t.push({label:"query_end",time:performance.now()}),r.data;let a=r.error,o=r.count,n=performance.now()-s;t.push({label:"end",time:performance.now()});let i={total:n.toFixed(1)+"ms",queryPrep:(t[1].time-t[0].time).toFixed(1)+"ms",queryExec:(t[2].time-t[1].time).toFixed(1)+"ms",postProcess:(t[3].time-t[2].time).toFixed(1)+"ms"};if(console.log("表测试性能分析:",i),console.log("表结构超速测试响应:",{hasError:!!a,count:o,responseTime:`${n.toFixed(0)}ms`}),a)throw console.error("表访问测试错误:",a),a;m({name:"表结构测试",status:"success",message:`验证成功: 表包含${o}条记录，耗时${n.toFixed(0)}ms`,duration:n,details:{recordCount:o,timings:i,perfTrackPoints:t.map(e=>({label:e.label,timeMs:e.time,elapsedFromStart:(e.time-s).toFixed(1)+"ms"}))}})}catch(r){let e=performance.now();console.error("表结构测试失败:",r),(0,i.H)("SupabaseTestPage","testTableSchema",r);let t={message:r.message||"未知错误",code:r.code,details:r.details,hint:r.hint,stack:r.stack};m({name:"表结构测试",status:"error",message:`表结构验证失败: ${r.message||"未知错误"}`,duration:e-s,details:t})}},h=async e=>{let s=performance.now();try{m({name:"数据读取测试",status:"pending",message:"正在读取菜谱数据..."});let{data:t,error:r,count:a}=await e.from("CHrecipes").select("id, 菜名, 菜系",{count:"exact"}).range(0,9),o=performance.now();if(r)throw r;if(!t||0===t.length)throw Error("无法获取菜谱数据");m({name:"数据读取测试",status:"success",message:`成功读取${t.length}条菜谱数据，总记录数: ${a}`,duration:o-s,details:{count:a,samplesCount:t.length,firstFew:t.slice(0,3).map(e=>({id:e.id,name:e.菜名}))}})}catch(t){let e=performance.now();(0,i.H)("SupabaseTestPage","testDataFetch",t),m({name:"数据读取测试",status:"error",message:`数据读取失败: ${t.message}`,duration:e-s,details:{error:t}})}},b=async e=>{let s=performance.now();try{m({name:"数据过滤测试",status:"pending",message:"正在测试数据过滤功能..."});let t=await Promise.all([e.from("CHrecipes").select("id, 菜名",{count:"exact"}).eq("菜系","川菜").limit(5),e.from("CHrecipes").select("id, 菜名",{count:"exact"}).ilike("菜名","%鱼%").limit(5),e.from("CHrecipes").select("id, 菜名, 菜系",{count:"exact"}).eq("菜系","粤菜").order("菜名",{ascending:!0}).limit(5)]),r=performance.now();for(let e=0;e<t.length;e++)if(t[e].error)throw Error(`过滤测试 #${e+1} 失败: ${t[e].error.message}`);m({name:"数据过滤测试",status:"success",message:"数据过滤功能正常",duration:r-s,details:{sichuan:{count:t[0].count,samples:t[0].data?.map(e=>e.菜名).join(", ")},fishSearch:{count:t[1].count,samples:t[1].data?.map(e=>e.菜名).join(", ")},cantonese:{count:t[2].count,samples:t[2].data?.map(e=>e.菜名).join(", ")}}})}catch(t){let e=performance.now();(0,i.H)("SupabaseTestPage","testFiltering",t),m({name:"数据过滤测试",status:"error",message:`数据过滤测试失败: ${t.message}`,duration:e-s,details:{error:t}})}},f=async e=>{let s=performance.now();try{m({name:"性能测试",status:"pending",message:"正在进行性能测试..."});let t=[];for(let s=0;s<3;s++){let r=performance.now();await e.from("CHrecipes").select("id, 菜名, 菜系, 口味特点").order("菜名",{ascending:!0}).range(10*s,(s+1)*10-1);let a=performance.now();t.push(a-r)}let r=t.reduce((e,s)=>e+s,0)/t.length,a=performance.now();m({name:"性能测试",status:"success",message:`性能测试完成，平均查询时间: ${r.toFixed(2)}ms`,duration:a-s,details:{iterations:3,timings:t,averageTime:r}})}catch(t){let e=performance.now();(0,i.H)("SupabaseTestPage","testPerformance",t),m({name:"性能测试",status:"error",message:`性能测试失败: ${t.message}`,duration:e-s,details:{error:t}})}};return(0,r.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,r.jsxs)("div",{className:"mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Supabase 连接测试"}),r.jsx("p",{className:"text-gray-600",children:"此页面用于测试与Supabase数据库的连接并诊断潜在问题"})]}),(0,r.jsxs)("div",{className:"mb-6 flex space-x-2",children:[r.jsx(o.default,{href:"/debug",className:"px-4 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",children:"返回调试面板"}),r.jsx("button",{onClick:p,disabled:t,className:`px-4 py-2 rounded ${t?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:t?"测试运行中...":"运行所有测试"})]}),c.initialized&&(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200 mb-6",children:[r.jsx("h2",{className:"text-lg font-semibold mb-2",children:"连接信息"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"Supabase URL:"})," ",c.url]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"font-medium",children:"API Key:"})," ",c.hasKey?"已配置":"未配置"]}),r.jsx("p",{className:"text-sm text-gray-600",children:"这些信息用于连接到您的Supabase项目。如果连接测试失败，请检查这些值是否正确设置在环境变量中。"})]})]}),r.jsx("div",{className:"space-y-4",children:0!==e.length||t?e.map((e,s)=>(0,r.jsxs)("div",{className:`border rounded-lg overflow-hidden ${"success"===e.status?"border-green-300":"error"===e.status?"border-red-300":"border-yellow-300"}`,children:[(0,r.jsxs)("div",{className:`px-4 py-3 flex justify-between items-center ${"success"===e.status?"bg-green-50":"error"===e.status?"bg-red-50":"bg-yellow-50"}`,children:[(0,r.jsxs)("div",{className:"flex items-center",children:["success"===e.status&&r.jsx("svg",{className:"w-5 h-5 text-green-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"error"===e.status&&r.jsx("svg",{className:"w-5 h-5 text-red-600 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"pending"===e.status&&(0,r.jsxs)("svg",{className:"w-5 h-5 text-yellow-600 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("h3",{className:`font-medium ${"success"===e.status?"text-green-800":"error"===e.status?"text-red-800":"text-yellow-800"}`,children:e.name})]}),e.duration&&(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[e.duration.toFixed(0),"ms"]})]}),(0,r.jsxs)("div",{className:"p-4 bg-white",children:[r.jsx("p",{className:`mb-3 ${"error"===e.status?"text-red-600":"text-gray-700"}`,children:e.message}),e.details&&"pending"!==e.status&&r.jsx("div",{className:"mt-3",children:(0,r.jsxs)("details",{children:[r.jsx("summary",{className:"text-sm font-medium text-gray-600 cursor-pointer",children:"查看详细信息"}),r.jsx("div",{className:"mt-2 bg-gray-50 p-3 rounded text-xs border border-gray-200 overflow-auto max-h-60",children:r.jsx("pre",{children:JSON.stringify(e.details,null,2)})})]})})]})]},s)):r.jsx("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200 text-center",children:r.jsx("p",{className:"text-gray-500",children:'点击"运行所有测试"按钮开始诊断'})})}),(0,r.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[r.jsx("h2",{className:"text-xl font-semibold mb-2",children:"测试说明"}),(0,r.jsxs)("ul",{className:"list-disc pl-5 space-y-2 text-blue-800",children:[(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium",children:"基础连接测试"})," - 检查是否能成功连接到Supabase服务器"]}),(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium",children:"表结构测试"})," - 验证数据库表是否包含所需的字段和正确的数据类型"]}),(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium",children:"数据读取测试"})," - 检查是否能成功获取菜谱数据并支持分页"]}),(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium",children:"数据过滤测试"})," - 验证各种过滤条件是否正常工作"]}),(0,r.jsxs)("li",{children:[r.jsx("span",{className:"font-medium",children:"性能测试"})," - 评估数据库查询的响应时间"]})]}),r.jsx("p",{className:"mt-4 text-sm text-blue-600",children:"如果任何测试失败，请检查环境变量配置和Supabase服务状态。 所有测试结果都会被记录到错误日志系统中，以便后续分析。"})]})]})}},3223:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>o,__esModule:()=>a,default:()=>n});let r=(0,t(1481).createProxy)(String.raw`D:\test\Cursor\What_to_eat_Web\src\app\debug\supabase-test\page.tsx`),{__esModule:a,$$typeof:o}=r,n=r.default}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[499,843,384,242],()=>t(403));module.exports=r})();