"use strict";exports.id=913,exports.ids=[913],exports.modules={6834:(e,t,r)=>{r.d(t,{Z:()=>u});var s=r(7580);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),n=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let c=(0,s.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:l="",children:n,iconNode:c,...u},d)=>(0,s.createElement)("svg",{ref:d,...i,width:t,height:t,stroke:e,strokeWidth:a?24*Number(r)/Number(t):r,className:o("lucide",l),...u},[...c.map(([e,t])=>(0,s.createElement)(e,t)),...Array.isArray(n)?n:[n]])),u=(e,t)=>{let r=(0,s.forwardRef)(({className:r,...l},i)=>(0,s.createElement)(c,{ref:i,iconNode:t,className:o(`lucide-${a(n(e))}`,`lucide-${e}`,r),...l}));return r.displayName=n(e),r}},821:(e,t,r)=>{r.d(t,{Z:()=>s});let s=(0,r(6834).Z)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},7694:(e,t,r)=>{r.d(t,{Z:()=>s});let s=(0,r(6834).Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7801:(e,t,r)=>{var s=r(7482);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},4550:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var s=r(4714);r(7580);let a=()=>s.jsx("footer",{className:"bg-white py-6 border-t border-gray-100",children:s.jsx("div",{className:"container mx-auto px-6",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"本网站菜谱内容来源于网络，仅供参考。请根据自身情况判断使用，本站不对由此产生的后果负责。"}),(0,s.jsxs)("p",{className:"text-gray-400 text-xs mt-2",children:["\xa9 ",new Date().getFullYear()," 今天吃什么 - 版权所有"]})]})})})},9346:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var s=r(4714),a=r(7580),l=r(7694);let n=(0,r(6834).Z)("search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);var o=r(821),i=r(6154),c=r(7801);let u=({label:e,color:t="blue",size:r="md",onRemove:a,onClick:n,className:o=""})=>(0,s.jsxs)("div",{className:`
        inline-flex items-center rounded-full border
        ${{blue:"bg-blue-500 text-white border-blue-600",green:"bg-green-500 text-white border-green-600",yellow:"bg-yellow-500 text-white border-yellow-600",red:"bg-red-500 text-white border-red-600",gray:"bg-gray-500 text-white border-gray-600",purple:"bg-purple-500 text-white border-purple-600"}[t]} 
        ${{sm:"text-xs py-0.5 px-2",md:"text-sm py-1 px-3",lg:"text-base py-1.5 px-4"}[r]}
        ${n?"cursor-pointer hover:opacity-80":""}
        ${o}
      `,onClick:n,children:[s.jsx("span",{className:"truncate max-w-[180px]",children:e}),a&&s.jsx("button",{type:"button",onClick:e=>{e.stopPropagation(),a()},className:`
            flex-shrink-0 rounded-full 
            hover:bg-opacity-20 hover:bg-gray-900
            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
          `,"aria-label":`移除 ${e}`,children:s.jsx(l.Z,{className:{sm:"w-3.5 h-3.5 ml-1",md:"w-4 h-4 ml-1.5",lg:"w-5 h-5 ml-2"}[r]})})]}),d=({placeholder:e="搜索菜谱、食材或烹饪方法...",initialValue:t="",onSearch:r,onIngredientSearch:d,className:h="",showFilterButton:m=!1,onFilterClick:f,disabled:g=!1})=>{let[p,x]=(0,a.useState)(""),[y,b]=(0,a.useState)(""),[w,v]=(0,a.useState)([]),[E,N]=(0,a.useState)(!1),[L,j]=(0,a.useState)(null),[C,S]=(0,a.useState)([]),[$,R]=(0,a.useState)([]),[A,k]=(0,a.useState)("AND"),I=(0,a.useRef)(null),_=(0,a.useRef)(null),T=(0,a.useRef)(null),M=(0,c.useRouter)(),P=(0,c.usePathname)();(function(e,t){(0,a.useEffect)(()=>{let r=r=>{!e.current||e.current.contains(r.target)||t(r)};return document.addEventListener("mousedown",r),document.addEventListener("touchstart",r),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)}},[e,t])})(T,()=>{N(!1),j(null)}),(0,a.useEffect)(()=>{let e=e=>{if(e.detail&&e.detail.tag){let t=e.detail.tag;C.includes(t)||S(e=>[...e,t])}},t=e=>{if(e.detail&&e.detail.tag){let t=e.detail.tag;S(e=>e.filter(e=>e!==t))}};return I.current&&(I.current.addEventListener("add-tag",e),I.current.addEventListener("remove-tag",t)),()=>{I.current&&(I.current.removeEventListener("add-tag",e),I.current.removeEventListener("remove-tag",t))}},[C]),(0,a.useEffect)(()=>()=>{},[]);let q=async e=>{let t=e.target.value;if(x(t),t.trim().length>1)try{let e=await (0,i.rf)(t);v(e),N(!0),j("required")}catch(e){console.error("获取搜索建议失败:",e),v([])}else v([]),N(!1),j(null)},H=async e=>{let t=e.target.value;if(b(t),t.trim().length>1)try{let e=await (0,i.rf)(t);v(e),N(!0),j("optional")}catch(e){console.error("获取搜索建议失败:",e),v([])}else v([]),N(!1),j(null)},W=e=>{if(e?.preventDefault(),!g){if(d)d(C,$);else if("/"===P){let e=new URLSearchParams;C.forEach(t=>{e.append("requiredIngredients",t)}),$.forEach(t=>{e.append("optionalIngredients",t)}),p.trim()&&e.set("query",p.trim());let t=U();t.cuisine&&e.set("cuisine",t.cuisine),t.flavors&&t.flavors.length>0&&t.flavors.forEach(t=>{e.append("flavors",t)}),t.difficulty&&e.set("difficulty",t.difficulty),t.cookingMethods&&t.cookingMethods.length>0&&t.cookingMethods.forEach(t=>{e.append("cookingMethods",t)}),t.dietaryRestrictions&&t.dietaryRestrictions.length>0&&t.dietaryRestrictions.forEach(t=>{e.append("dietaryRestrictions",t)}),(C.length>0||$.length>0||p.trim()||Z(t))&&M.push(`/recipes?${e.toString()}`)}N(!1),j(null)}},U=()=>({cuisine:null,flavors:[],difficulty:null,cookingMethods:[],dietaryRestrictions:[]}),Z=e=>e.cuisine||e.flavors&&e.flavors.length>0||e.difficulty||e.cookingMethods&&e.cookingMethods.length>0||e.dietaryRestrictions&&e.dietaryRestrictions.length>0,O=e=>{"required"===L?(C.includes(e)||S([...C,e]),x(""),I.current?.focus()):"optional"===L&&($.includes(e)||R([...$,e]),b(""),_.current?.focus()),N(!1),j(null)},z=(0,a.useCallback)(e=>{e&&(console.log(`移除标签: ${e}`),C.includes(e)&&S(t=>t.filter(t=>t!==e)),$.includes(e)&&R(t=>t.filter(t=>t!==e)),d&&d(C.filter(t=>t!==e),$.filter(t=>t!==e)))},[C,$,d]),D=e=>{"Enter"===e.key&&(e.preventDefault(),W())};return(0,s.jsxs)("div",{className:`relative w-full ${h}`,children:[(0,s.jsxs)("form",{onSubmit:W,className:"w-full",children:[s.jsx("div",{className:"relative mb-2",children:(0,s.jsxs)("div",{className:"flex items-center border rounded-md focus-within:ring-2 focus-within:ring-blue-300 bg-white overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-1 px-2 py-1 flex-grow",children:[C.map((e,t)=>s.jsx(u,{label:e,onRemove:()=>z(e),className:"bg-blue-100 text-blue-700"},`req-${t}`)),s.jsx("input",{ref:I,type:"text",className:"search-bar-required flex-grow min-w-[100px] py-2 px-3 text-gray-700 focus:outline-none",placeholder:"必选食材/调料",value:p,onChange:q,onKeyDown:D,disabled:g,"aria-label":"必选食材搜索"})]}),(p.trim()||C.length>0)&&s.jsx("button",{type:"button",onClick:()=>{x(""),S([]),I.current?.focus()},className:"text-gray-400 hover:text-gray-600 px-2","aria-label":"清除必选输入",children:s.jsx(l.Z,{size:16})})]})}),s.jsx("div",{className:"relative mb-4",children:(0,s.jsxs)("div",{className:"flex items-center border rounded-md focus-within:ring-2 focus-within:ring-blue-300 bg-white overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-1 px-2 py-1 flex-grow",children:[$.map((e,t)=>s.jsx(u,{label:e,onRemove:()=>z(e),className:"bg-green-100 text-green-700"},`opt-${t}`)),s.jsx("input",{ref:_,type:"text",className:"search-bar-optional flex-grow min-w-[100px] py-2 px-3 text-gray-700 focus:outline-none",placeholder:"可选食材/调料",value:y,onChange:H,onKeyDown:D,disabled:g,"aria-label":"可选食材搜索"})]}),(y.trim()||$.length>0)&&s.jsx("button",{type:"button",onClick:()=>{b(""),R([]),_.current?.focus()},className:"text-gray-400 hover:text-gray-600 px-2","aria-label":"清除可选输入",children:s.jsx(l.Z,{size:16})})]})}),s.jsx("div",{className:"flex w-full justify-center",children:(0,s.jsxs)("button",{type:"submit",className:`w-full md:w-auto bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-6 py-2 flex items-center justify-center transition-colors ${g?"opacity-50 cursor-not-allowed":""}`,disabled:g,children:[s.jsx(n,{size:18,className:"mr-2"}),s.jsx("span",{children:"搜索菜谱"})]})})]}),E&&w.length>0&&s.jsx("div",{ref:T,className:"absolute z-10 mt-1 w-full bg-white border border-gray-200 rounded-md shadow-lg max-h-60 overflow-y-auto",children:s.jsx("ul",{className:"py-1 divide-y divide-gray-100",children:w.map((e,t)=>s.jsx("li",{className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-gray-700",onClick:()=>O(e),children:e},t))})}),m&&s.jsx("button",{type:"button",className:"absolute top-0 right-0 mt-2 mr-2 text-gray-500 hover:text-gray-700",onClick:f,children:s.jsx(o.Z,{size:20})})]})}},6154:(e,t,r)=>{let s;async function a(e){try{if(!e||e.trim().length<1)return[];let t=e.trim().toLowerCase(),r=new Set;console.log(`搜索建议: 查询"${t}"`);let a=!1;try{console.log("尝试使用RPC函数search_ingredients_and_seasonings");let{data:e,error:l}=await s.rpc("search_ingredients_and_seasonings",{search_term:t});l?console.error("SQL RPC搜索出错:",l):e&&Array.isArray(e)&&(e.forEach(e=>{e&&"string"==typeof e&&r.add(e)}),console.log(`SQL RPC搜索返回${e.length}个结果`),a=r.size>0)}catch(e){console.error("SQL RPC函数调用异常:",e)}if(!a){console.log("RPC函数调用失败，尝试使用直接的SQL查询");try{let e=`
          WITH all_items AS (
            -- 从食材中提取
            SELECT name FROM (
              SELECT DISTINCT jsonb_path_query(食材::jsonb, '$[*].名称') AS name 
              FROM "CHrecipes" 
              WHERE 食材::text ILIKE '%${t}%'
              LIMIT 50
            ) AS ingredients
            WHERE name::text ILIKE '%${t}%'
            
            UNION
            
            -- 从调料中提取
            SELECT name FROM (
              SELECT DISTINCT jsonb_path_query(调料::jsonb, '$[*].名称') AS name 
              FROM "CHrecipes" 
              WHERE 调料::text ILIKE '%${t}%'
              LIMIT 50
            ) AS seasonings
            WHERE name::text ILIKE '%${t}%'
            
            UNION
            
            -- 从菜名中提取
            SELECT 菜名 AS name 
            FROM "CHrecipes" 
            WHERE 菜名 ILIKE '%${t}%'
            LIMIT 20
          )
          
          SELECT DISTINCT name::text
          FROM all_items
          WHERE name IS NOT NULL
          LIMIT 30
        `,{data:a,error:l}=await s.rpc("exec_sql",{sql_query:e});l?console.error("执行SQL查询出错:",l):a&&Array.isArray(a)&&(a.forEach(e=>{e&&e.name&&"string"==typeof e.name&&r.add(e.name)}),console.log(`SQL查询返回${a.length}个结果`))}catch(e){console.error("执行SQL查询异常:",e)}}if(r.size<5){console.log("回退到分别查询食材、调料和菜名");try{let{data:e,error:a}=await s.from("CHrecipes").select("食材").ilike("食材::text",`%${t}%`).limit(20);a?console.error("搜索食材时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.食材&&Array.isArray(e.食材)&&e.食材.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(t)&&r.add(e.名称)})}),console.log(`食材搜索返回${e.length}个结果`))}catch(e){console.error("食材搜索异常:",e)}try{let{data:e,error:a}=await s.from("CHrecipes").select("调料").ilike("调料::text",`%${t}%`).limit(20);a?console.error("搜索调料时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.调料&&Array.isArray(e.调料)&&e.调料.forEach(e=>{e&&e.名称&&"string"==typeof e.名称&&e.名称.toLowerCase().includes(t)&&r.add(e.名称)})}),console.log(`调料搜索返回${e.length}个结果`))}catch(e){console.error("调料搜索异常:",e)}try{let{data:e,error:a}=await s.from("CHrecipes").select("菜名").ilike("菜名",`%${t}%`).limit(10);a?console.error("搜索菜名时出错:",a):e&&Array.isArray(e)&&(e.forEach(e=>{e&&e.菜名&&"string"==typeof e.菜名&&r.add(e.菜名)}),console.log(`菜名搜索返回${e.length}个结果`))}catch(e){console.error("菜名搜索异常:",e)}}let l=Array.from(r).sort((e,r)=>{let s=e.toLowerCase(),a=r.toLowerCase();return s===t&&a!==t?-1:a===t&&s!==t?1:s.startsWith(t)&&!a.startsWith(t)?-1:a.startsWith(t)&&!s.startsWith(t)?1:s.includes(t)&&!a.includes(t)?-1:a.includes(t)&&!s.includes(t)?1:e.length-r.length});if(console.log(`找到${l.length}个建议`),0===l.length)return[`${e}`,`${e}料理`,`${e}做法`,`家常${e}`];return l.slice(0,10)}catch(e){return console.error("获取关键词建议失败:",e),[]}}function l(e,t){if(!t.trim())return e;let r=function(e){if(!e)return[];let t=e.trim();for(let e of[" ",",","，",";","；"])" "!==e&&(t=t.split(e).join(" "));return t.split(" ").map(e=>e.trim()).filter(e=>e.length>0)}(e),s=t.trim().toLowerCase();return r.some(e=>e.toLowerCase()===s)?e:e.trim()?`${e.trim()} ${t.trim()}`:t.trim()}r.d(t,{rf:()=>a,xx:()=>l}),r(8384),process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,console.log("静态构建环境检测到，使用模拟的Supabase客户端在keywordUtils中"),s={rpc:()=>({execute:async()=>({data:[],error:null})}),from:()=>({select:()=>({ilike:()=>({execute:async()=>({data:[],error:null})}),textSearch:()=>({execute:async()=>({data:[],error:null})}),execute:async()=>({data:[],error:null})})})}}};