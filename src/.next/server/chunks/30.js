"use strict";exports.id=30,exports.ids=[30],exports.modules={3793:(e,t,o)=>{o.d(t,{Ki:()=>s});var r=o(2615);function i(e,t){if(null==e)return t;if(Array.isArray(e))return e;if("string"==typeof e){if(""===e.trim())return t;try{return JSON.parse(e)}catch(t){return(0,r.KE)("DataMapper","safeParseJsonb",`非JSON字符串值: ${e}`),[e]}}if("object"==typeof e)try{return e}catch(o){return(0,r.KE)("DataMapper","safeParseJsonb",`无法处理的对象类型: ${JSON.stringify(e)}`),t}return(0,r.KE)("DataMapper","safeParseJsonb",`无法处理的值类型: ${typeof e}, 值: ${String(e)}`),t}function n(){return"temp-"+Date.now().toString(36)+Math.random().toString(36).substring(2,7)}function s(e){if(!Array.isArray(e))return(0,r.H)("DataMapper","transformDbRecipesToFrontend",`接收到非数组输入: ${typeof e}`,{value:e}),[];console.log(`开始批量转换 ${e.length} 个菜谱数据`);let t=[];for(let o=0;o<e.length;o++)try{if(!e[o]){(0,r.KE)("DataMapper","transformDbRecipesToFrontend",`索引 ${o} 处的数据为空`);continue}let s=function(e){try{let t=[];e.是否纯素&&t.push("纯素"),e.是否清真&&t.push("清真"),e.是否无麸质&&t.push("无麸质");let o=i(e.口味特点,[]),s=i(e.烹饪技法,[]),l=i(e.食材,[]),a=i(e.调料,[]),c=[],g=[],d=[];if("object"==typeof e.步骤&&null!==e.步骤){let t=e.步骤;t.hasOwnProperty("准备步骤")&&t.hasOwnProperty("烹饪步骤")?(c=Array.isArray(t["准备步骤"])?t["准备步骤"]:[],g=Array.isArray(t["烹饪步骤"])?t["烹饪步骤"]:[],d=[...c,...g]):g=d=i(e.步骤,[])}else g=d=i(e.步骤,[]);let u=i(e.注意事项,[]),f=30;if("number"==typeof e.烹饪时间)f=e.烹饪时间;else if("string"==typeof e.烹饪时间){let t=parseInt(e.烹饪时间,10);isNaN(t)||(f=t)}else if(e.烹饪时间&&"object"==typeof e.烹饪时间)try{let t=JSON.stringify(e.烹饪时间).match(/\d+/);t&&(f=parseInt(t[0],10))}catch(e){(0,r.KE)("DataMapper","transformDbToFrontend",`无法解析烹饪时间: ${e instanceof Error?e.message:String(e)}`)}return{id:e.id||n(),name:e.菜名||"未命名菜谱",cuisine:e.菜系||"其他",description:"",ingredients:l,seasonings:a,flavors:o,difficulty:e.烹饪难度||"中等",cookingTime:f,steps:d,preparationSteps:c,cookingSteps:g,tips:u,imageUrl:"/images/placeholder-food.jpg",cookingMethod:s,dietaryRestrictions:t,tags:[]}}catch(t){return(0,r.H)("DataMapper","transformDbToFrontend",t,{recipeId:e?.id}),{id:e?.id||n(),name:e?.菜名||"转换错误的菜谱",cuisine:"其他",description:"数据转换过程中发生错误",ingredients:[],seasonings:[],flavors:[],difficulty:"简单",cookingTime:30,steps:[],preparationSteps:[],cookingSteps:[],tips:[],imageUrl:"/images/placeholder-food.jpg",cookingMethod:[],dietaryRestrictions:[],tags:[]}}}(e[o]);t.push(s)}catch(t){(0,r.H)("DataMapper","transformDbRecipesToFrontend",t,{index:o,data:e[o]?{id:e[o].id,name:e[o].菜名}:null})}return console.log(`批量转换完成，成功转换 ${t.length} / ${e.length} 个菜谱`),t}},1418:(e,t,o)=>{o.d(t,{x:()=>r});function r(){return[{id:"1",name:"红烧肉",description:"经典的中式菜肴，肥而不腻，口感醇厚。",ingredients:["五花肉","姜","蒜","葱","冰糖"],seasonings:["生抽","老抽","料酒","八角","桂皮"],flavors:["咸鲜","甜"],difficulty:"中等",cookingTime:60,steps:["五花肉切成大块，冷水下锅焯水去血沫","锅中放少量油，加入冰糖小火炒至融化呈棕色","放入焯好的五花肉翻炒均匀上色","加入姜片、蒜瓣、八角、桂皮等香料","倒入生抽、老抽、料酒，加水没过肉","大火烧开后转小火慢炖1小时","最后收汁，撒上葱花即可"],preparationSteps:["五花肉洗净切成4厘米见方的块","准备好所有调料和配料"],tips:["焯水时加入料酒可以去腥","炖煮时间越长肉越烂","可以加入适量白萝卜，吸收肉的香味"],imageUrl:"/images/hongshaorou.jpg",tags:["家常菜","红烧","肉类"],cuisine:"川菜",cookingMethod:["炖","烧"],dietaryRestrictions:[]},{id:"2",name:"西红柿炒鸡蛋",description:"家常快手菜，酸甜可口，简单美味。",ingredients:["西红柿","鸡蛋","葱"],seasonings:["盐","白糖","食用油"],flavors:["酸甜"],difficulty:"简单",cookingTime:15,steps:["西红柿洗净切块，葱切段","鸡蛋打散，加少许盐搅匀","热锅冷油，倒入蛋液炒至金黄盛出","锅中留底油，放入葱段爆香","加入西红柿块翻炒至出汁","加入少许白糖提鲜","倒入炒好的鸡蛋一起翻炒均匀","加盐调味即可"],preparationSteps:["西红柿洗净切成块","鸡蛋打散加少许盐搅匀"],tips:["西红柿炒鸡蛋的顺序是先炒鸡蛋再炒西红柿","加入少量白糖可以中和西红柿的酸味","不喜欢酸味可以选择完全成熟的西红柿"],imageUrl:"/images/fanqiejidan.jpg",tags:["家常菜","快手菜","素菜"],cuisine:"家常菜",cookingMethod:["炒"],dietaryRestrictions:["纯素"]},{id:"3",name:"水煮鱼",description:"四川传统名菜，麻辣鲜香，口感滑嫩。",ingredients:["草鱼","豆芽","生菜","花椒","干辣椒"],seasonings:["郫县豆瓣酱","生抽","料酒","姜","蒜","盐","鸡精"],flavors:["麻辣"],difficulty:"中等",cookingTime:40,steps:["草鱼去鳞去内脏，切片，加盐、料酒、淀粉腌制15分钟","锅中水烧开，加入豆芽和生菜焯水后捞出铺盘底","另起锅，油温6成热放入花椒和干辣椒爆香","加入郫县豆瓣酱炒出红油","加入姜末、蒜末炒香","加入适量清水，放入腌好的鱼片","水开后撇去浮沫，加入盐、鸡精调味","出锅前浇上热油，撒上香菜"],preparationSteps:["草鱼处理干净切片","豆芽和生菜洗净","准备花椒、干辣椒等调料"],tips:["鱼片切得薄一些，容易入味且熟得快","鱼片下锅后不要用力搅动，以免破坏鱼肉结构","最后淋热油可以增香提味"],imageUrl:"/images/shuizhuyu.jpg",tags:["川菜","水煮","鱼"],cuisine:"川菜",cookingMethod:["煮"],dietaryRestrictions:[]},{id:"4",name:"宫保鸡丁",description:"经典川菜，鸡肉鲜嫩，花生香脆，甜辣适中。",ingredients:["鸡胸肉","花生米","干辣椒","花椒","葱","姜","蒜"],seasonings:["生抽","醋","白糖","料酒","淀粉","盐"],flavors:["麻辣","甜酸"],difficulty:"中等",cookingTime:30,steps:["鸡胸肉切丁，用生抽、料酒、盐、淀粉腌制15分钟","花生米提前用油炸熟或者干炒熟","干辣椒切段，葱姜蒜切末","锅热油温5成热，放入花椒和干辣椒炒香","加入葱姜蒜爆香","放入腌好的鸡丁翻炒至变色","加入生抽、醋、白糖、盐调味","勾芡收汁，加入炒熟的花生米拌匀即可"],preparationSteps:["鸡胸肉切丁并腌制","花生米炒熟","准备好调料"],tips:["鸡肉不要过度搅拌，以免出水影响口感","如果喜欢辣一些，可以增加干辣椒的量","最后收汁时火候要大，速度要快"],imageUrl:"/images/gongbaojiding.jpg",tags:["川菜","炒菜","鸡肉"],cuisine:"川菜",cookingMethod:["炒"],dietaryRestrictions:[]},{id:"5",name:"糖醋排骨",description:"经典汉族名菜，酸甜可口，排骨酥烂。",ingredients:["猪小排","姜","蒜","葱","白芝麻"],seasonings:["生抽","醋","白糖","料酒","番茄酱","淀粉"],flavors:["酸甜"],difficulty:"中等",cookingTime:45,steps:["猪小排洗净切段，焯水去血沫","锅中放油，放入姜片、蒜瓣爆香","加入焯好的排骨翻炒上色","加入生抽、料酒翻炒均匀","加入适量清水、白糖、醋、番茄酱","大火烧开后转小火炖至排骨酥烂","大火收汁，撒上葱花和白芝麻"],preparationSteps:["猪小排洗净切段","准备好各种调料"],tips:["焯水时加入料酒可以去腥","糖醋汁的比例可以根据个人口味调整","收汁时不要盖锅盖，以便让汤汁更好地收浓"],imageUrl:"/images/tangcupaigu.jpg",tags:["家常菜","糖醋","排骨"],cuisine:"鲁菜",cookingMethod:["炖","烧"],dietaryRestrictions:[]},{id:"6",name:"清蒸鲈鱼",description:"经典粤菜，鲜香嫩滑，保留了鱼的原汁原味。",ingredients:["鲈鱼","姜","蒜","葱","红辣椒"],seasonings:["生抽","盐","料酒","香油"],flavors:["鲜香"],difficulty:"中等",cookingTime:25,steps:["鲈鱼宰杀干净，去鳞去内脏，在两面各划几刀","鱼身抹上盐和料酒腌制10分钟去腥","葱姜蒜切丝，红辣椒切圈","将葱姜蒜一部分铺在盘底，鱼放上去","锅中水烧开，放入装有鱼的盘子，大火蒸8-10分钟","取出后撒上剩余的葱姜蒜和辣椒圈","锅中热油，浇在葱姜蒜上","淋上生抽和香油即可"],preparationSteps:["鲈鱼处理干净","准备好各种配料"],tips:["选择新鲜的鲈鱼更加鲜美","蒸鱼的时间不能过长，以免肉质过老","最后淋上热油能激发出葱姜蒜的香味"],imageUrl:"/images/qingzhengluyu.jpg",tags:["粤菜","蒸菜","鱼"],cuisine:"粤菜",cookingMethod:["蒸"],dietaryRestrictions:[]}]}},3030:(e,t,o)=>{o.d(t,{OQ:()=>l,Z2:()=>c,ZY:()=>g,createUserFeedbackTable:()=>f,s8:()=>d}),o(8384);var r=o(1418),i=o(3793);let n=process.env.NEXT_PUBLIC_SUPABASE_URL||"https://ijwimydlumbolmpnmezt.supabase.co",s=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlqd2lteWRsdW1ib2xtcG5tZXp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI0NjExMDUsImV4cCI6MjA1ODAzNzEwNX0.ynhuFYG6dkoxDgEyDwEnWdZ-DRWx3illLZGyYwn_UnA";console.log("初始化Supabase客户端:"),console.log("- URL:",n),console.log("- 使用默认值:","https://ijwimydlumbolmpnmezt.supabase.co"===n?"是":"否"),console.log("- 密钥长度:",s?s.length:"未设置"),console.log("静态构建环境检测到，使用模拟的Supabase客户端");let l={from:()=>({select:()=>({eq:()=>({single:async()=>({data:null,error:null}),maybeSingle:async()=>({data:null,error:null}),execute:async()=>({data:[],error:null})}),in:()=>({execute:async()=>({data:[],error:null})}),limit:()=>({range:()=>({execute:async()=>({data:[],error:null,count:0})}),execute:async()=>({data:[],error:null})}),range:()=>({execute:async()=>({data:[],error:null})}),filter:()=>({execute:async()=>({data:[],error:null})}),execute:async()=>({data:[],error:null,count:0})})}),rpc:()=>({execute:async()=>({data:null,error:null})}),auth:{getUser:async()=>({data:{user:null},error:null})}};function a(e,t){if(!t||0===t.length)throw Error("必须提供至少一个搜索字段");let o=t.map(t=>{let o=t.includes(".")||/[\u4e00-\u9fa5]/.test(t)||t.match(/^(id|all|table|column|database|from|to|select|where|order|by|or|and|not|if|else)$/i)?`"${t}"`:t;return`${o}.ilike.%${e}%`});return`(${o.join(",")})`}async function c(e){try{console.log("使用筛选条件从Supabase加载菜谱数据...",e);let t=l.from("CHrecipes").select("*");if(e.cuisine&&(t=t.eq("菜系",e.cuisine),console.log(`添加菜系筛选: ${e.cuisine}`)),e.difficulty&&(t=t.eq("烹饪难度",e.difficulty),console.log(`添加难度筛选: ${e.difficulty}`)),e.dietaryRestrictions&&e.dietaryRestrictions.length>0)for(let o of(console.log(`添加饮食限制筛选: ${e.dietaryRestrictions.join(", ")}`),e.dietaryRestrictions))"纯素"===o?(t=t.eq("是否纯素",!0),console.log("添加纯素筛选条件")):"清真"===o?(t=t.eq("是否清真",!0),console.log("添加清真筛选条件")):"无麸质"===o&&(t=t.eq("是否无麸质",!0),console.log("添加无麸质筛选条件"));let o=[],r=0,n=!0;for(;n;){let e=1e3*r,i=e+1e3-1;console.log(`加载筛选菜谱批次 ${r+1}，范围 ${e}-${i}`);let{data:s,error:l}=await t.range(e,i);if(l){console.error(`加载筛选菜谱批次 ${r+1} 出错:`,l);break}if(!s||0===s.length){console.log(`筛选批次 ${r+1} 未返回任何数据，加载完成`),n=!1;break}console.log(`筛选批次 ${r+1} 加载了 ${s.length} 条菜谱`),o=[...o,...s],s.length<1e3?(console.log(`筛选批次 ${r+1} 数据量少于每页数量，加载完成`),n=!1):r++}console.log(`从Supabase加载了 ${o.length} 个菜谱`);let s=(0,i.Ki)(o);return e.ingredients&&e.ingredients.length>0&&(console.log(`在客户端按食材筛选: ${e.ingredients.join(", ")}`),s=s.filter(t=>e.ingredients.some(e=>Array.isArray(t.ingredients)&&t.ingredients.some(t=>"string"==typeof t&&t.toLowerCase().includes(e.toLowerCase())))),console.log(`按食材筛选后剩余 ${s.length} 个菜谱`)),e.taste&&(console.log(`在客户端按口味筛选: ${e.taste}`),s=s.filter(t=>Array.isArray(t.flavors)&&t.flavors.includes(e.taste)),console.log(`按口味筛选后剩余 ${s.length} 个菜谱`)),e.cookingMethod&&(console.log(`在客户端按烹饪方式筛选: ${e.cookingMethod}`),s=s.filter(t=>t.cookingMethod&&(Array.isArray(t.cookingMethod)?t.cookingMethod.includes(e.cookingMethod):t.cookingMethod===e.cookingMethod)),console.log(`按烹饪方式筛选后剩余 ${s.length} 个菜谱`)),console.log(`筛选后得到 ${s.length} 个菜谱`),s}catch(o){console.error("筛选菜谱数据失败:",o),console.log("远程筛选失败:",o),console.log("尝试使用示例数据进行客户端筛选...");let t=[...(0,r.x)()];return e.cuisine&&(t=t.filter(t=>t.cuisine===e.cuisine)),e.difficulty&&(t=t.filter(t=>t.difficulty===e.difficulty)),e.ingredients&&e.ingredients.length>0&&(t=t.filter(t=>e.ingredients.some(e=>Array.isArray(t.ingredients)&&t.ingredients.some(t=>t.toLowerCase().includes(e.toLowerCase()))))),e.taste&&(t=t.filter(t=>Array.isArray(t.flavors)&&t.flavors.includes(e.taste))),e.cookingMethod&&(t=t.filter(t=>t.cookingMethod&&(Array.isArray(t.cookingMethod)?t.cookingMethod.includes(e.cookingMethod):t.cookingMethod===e.cookingMethod))),e.dietaryRestrictions&&e.dietaryRestrictions.length>0&&(t=t.filter(t=>{let o=Array.isArray(t.dietaryRestrictions)?t.dietaryRestrictions:[];return e.dietaryRestrictions.some(e=>o.includes(e))})),console.log(`示例数据筛选后得到 ${t.length} 个菜谱`),t}}async function g(e){try{console.log(`尝试从Supabase获取菜谱ID: ${e}`);let{data:t,error:o}=await l.from("CHrecipes").select("*").eq("id",e).single();if(o)throw console.error("获取菜谱详情错误:",o),o;return(0,i.Ki)([t])[0]}catch(o){console.error(`获取ID为 ${e} 的菜谱失败:`,o);let t=(0,r.x)().find(t=>t.id===e);if(t)return console.log(`从示例数据获取菜谱ID: ${e} (${t.name})`),t;return null}}async function d(e){try{console.log(`在Supabase搜索菜谱: "${e}"`);let t=e.split(/\s+/).filter(e=>""!==e.trim());if(console.log(`检测到${t.length}个搜索关键词:`,t),0===t.length)return console.log("搜索词为空，返回空结果"),[];let o=["菜名","步骤","食材"],r=[],n=0,s=!0,c=l.from("CHrecipes").select("*");if(1===t.length){console.log(`构建多字段搜索查询，字段: ${o.join(", ")}`);let e=a(t[0],o);console.log(`生成的OR查询条件: ${e}`),c=c.or(e)}else console.log("多关键词搜索模式，应用AND逻辑"),t.forEach((e,t)=>{let r=a(e,o);0===t&&(c=c.or(r))});for(;s;){let e=1e3*n,o=e+1e3-1;console.log(`加载搜索菜谱批次 ${n+1}，范围 ${e}-${o}`);let{data:i,error:l}=await c.range(e,o);if(l){console.error(`加载搜索菜谱批次 ${n+1} 出错:`,l);break}if(!i||0===i.length){console.log(`搜索批次 ${n+1} 未返回任何数据，加载完成`),s=!1;break}if(console.log(`搜索批次 ${n+1} 加载了 ${i.length} 条菜谱`),t.length>1){let e=i.filter(e=>{let o=((e.菜名||"")+" "+(e.步骤||"")+" "+(e.食材||"")).toLowerCase();return t.every(e=>o.includes(e.toLowerCase()))});console.log(`批次 ${n+1} 筛选后得到 ${e.length} 条符合所有关键词的菜谱`),r=[...r,...e]}else r=[...r,...i];i.length<1e3?(console.log(`搜索批次 ${n+1} 数据量少于每页数量，加载完成`),s=!1):n++}console.log(`搜索出 ${r.length} 个菜谱`);let g=(0,i.Ki)(r);return g=function(e,t){let o=t.toLowerCase();return[...e].sort((e,t)=>{let r=u(e,o);return u(t,o)-r})}(g,e)}catch(n){console.error("搜索菜谱出错:",n),console.log("尝试在示例数据中搜索:",e);let t=(0,r.x)(),o=e.split(/\s+/).filter(e=>""!==e.trim()),i=t.filter(t=>{let r=((t.name||"")+" "+(t.description||"")+" "+(Array.isArray(t.ingredients)?t.ingredients.join(" "):"")).toLowerCase();return o.length>1?o.every(e=>r.includes(e.toLowerCase())):r.includes(e.toLowerCase())});return console.log(`示例数据中找到 ${i.length} 个匹配菜谱`),i}}function u(e,t){let o=0,r=t.toLowerCase().trim();if(!r)return 0;let i=r.split(/\s+/).filter(Boolean),n=[];for(let t of i){let o=0,r=e.name?e.name.toLowerCase():"";if(r.includes(t)&&(o+=15,r===t?o+=5:r.startsWith(t)&&(o+=3),r.length>0)){let e=Math.min(t.length/r.length,1);o+=2*e}if(e.ingredients&&Array.isArray(e.ingredients)){let r=e.ingredients.filter(e=>{let o="";return"string"==typeof e?o=e.toLowerCase():"object"==typeof e&&null!==e&&(o=(e.name||e.名称||"").toLowerCase()),o&&o.includes(t)});if(r.length>0){o+=12,r.some(e=>{let o="";return"string"==typeof e?o=e.toLowerCase():"object"==typeof e&&null!==e&&(o=(e.name||e.名称||"").toLowerCase()),o===t})&&(o+=3);let i=Math.min(r.length/e.ingredients.length,1);o+=3*i}}if(e.seasonings&&Array.isArray(e.seasonings)){let r=e.seasonings.filter(e=>{let o="";return"string"==typeof e?o=e.toLowerCase():"object"==typeof e&&null!==e&&(o=(e.name||e.名称||"").toLowerCase()),o&&o.includes(t)});r.length>0&&(o+=8,r.some(e=>{let o="";return"string"==typeof e?o=e.toLowerCase():"object"==typeof e&&null!==e&&(o=(e.name||e.名称||"").toLowerCase()),o===t})&&(o+=2))}let i=!1,s=e=>{for(let r of e)if("string"==typeof r&&r.toLowerCase().includes(t)){o+=6,i=!0;break}};if(e.cookingSteps&&Array.isArray(e.cookingSteps)&&s(e.cookingSteps),!i&&e.steps&&Array.isArray(e.steps)&&s(e.steps),!i&&e.preparationSteps&&Array.isArray(e.preparationSteps)&&s(e.preparationSteps),e.cuisine&&"string"==typeof e.cuisine){let r=e.cuisine.toLowerCase();r.includes(t)&&(o+=4,r===t&&(o+=1))}if(e.cookingMethod&&Array.isArray(e.cookingMethod)){for(let r of e.cookingMethod)if("string"==typeof r&&r.toLowerCase().includes(t)){o+=4,r.toLowerCase()===t&&(o+=1);break}}if(e.flavors&&Array.isArray(e.flavors)){for(let r of e.flavors)if("string"==typeof r&&r.toLowerCase().includes(t)){o+=3,r.toLowerCase()===t&&(o+=1);break}}e.difficulty&&"string"==typeof e.difficulty&&e.difficulty.toLowerCase().includes(t)&&(o+=2),n.push(o)}if(n.length>0&&(o=n.reduce((e,t)=>e+t,0),n.length>1)){let e=.05*(n.length-1)*o;o+=e}return console.log(`菜谱"${e.name}"的相关性得分: ${o.toFixed(2)}`),o}async function f(){try{console.log("尝试创建user_feedback表...");let{error:e}=await l.rpc("execute_sql",{sql:`
        CREATE TABLE IF NOT EXISTS user_feedback (
          id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
          name TEXT NOT NULL,
          email TEXT NOT NULL,
          subject TEXT NOT NULL,
          message TEXT NOT NULL,
          status TEXT DEFAULT 'new',
          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
        );
        
        -- 创建RLS策略
        ALTER TABLE user_feedback ENABLE ROW LEVEL SECURITY;
        
        -- 允许匿名插入
        CREATE POLICY "Allow anonymous inserts" ON user_feedback
        FOR INSERT WITH CHECK (true);
        
        -- 创建辅助函数
        CREATE OR REPLACE FUNCTION create_user_feedback_table()
        RETURNS void
        LANGUAGE plpgsql
        SECURITY DEFINER
        AS $$
        BEGIN
          -- 表已通过上面的语句创建，此函数仅作为调用入口
          NULL;
        END;
        $$;
        
        -- 授予匿名用户执行权限
        GRANT EXECUTE ON FUNCTION create_user_feedback_table TO anon;
      `});if(e)throw e;return console.log("成功创建user_feedback表"),!0}catch(e){return console.error("创建user_feedback表失败:",e),!1}}}};